# Chapter 1: 激光雷达基础原理

激光雷达（LiDAR - Light Detection and Ranging）是一种主动式光学遥感技术，通过发射激光脉冲并接收目标反射的光信号来精确测量距离。本章将深入探讨激光雷达的核心物理原理，包括时间飞行测距、相干探测、雪崩探测以及激光雷达方程。通过理解这些基础原理，读者将掌握激光雷达如何实现毫米级精度的三维空间感知，为后续章节的技术实现和应用奠定坚实的理论基础。

## 1.1 光的时间飞行原理 (ToF)

时间飞行（Time of Flight，ToF）是激光雷达最基础也是应用最广泛的测距原理。其核心思想极其简单：通过测量光脉冲从发射到接收的时间间隔来计算目标距离。

### 1.1.1 基本距离计算

激光雷达发射一个短脉冲，当脉冲遇到目标后会产生反射，部分反射光被接收器捕获。距离计算公式为：

$$d = \frac{c \cdot t}{2}$$

其中：
- $d$ 是目标距离（米）
- $c$ 是光速（约 $3 \times 10^8$ m/s）
- $t$ 是往返时间（秒）
- 除以2是因为光走了往返路程

**计算实例1**：如果测得往返时间为 $t = 666.7$ ns，则目标距离为：
$$d = \frac{3 \times 10^8 \times 666.7 \times 10^{-9}}{2} = 100 \text{ m}$$

这意味着每纳秒的时间对应15厘米的距离，因此时间测量的精度直接决定了距离测量的精度。

### 1.1.2 时间分辨率与距离精度

实际系统中，时间测量存在不确定性$\sigma_t$，这将传播到距离测量中。考虑测量噪声的统计特性，距离精度可表示为：

$$\sigma_d = \frac{c \cdot \sigma_t}{2\sqrt{2}}$$

$\sqrt{2}$因子来源于信号检测理论中的匹配滤波器最优检测。

**计算实例2**：若时间测量精度$\sigma_t = 100$ ps（皮秒），则距离精度为：
$$\sigma_d = \frac{3 \times 10^8 \times 100 \times 10^{-12}}{2\sqrt{2}} = 10.6 \text{ mm}$$

这解释了为什么高端激光雷达能实现厘米甚至毫米级精度——它们使用了精度达到皮秒级的时间测量电路。

### 1.1.3 光速修正因子

光在大气中的传播速度并非真空光速，而是受到温度、压力和波长的影响。折射率修正公式（Edlén公式简化版）：

$$n(T,P,\lambda) = 1 + \frac{(n_s - 1) \cdot P}{P_s} \cdot \frac{T_s}{T}$$

其中：
- $n_s = 1.000293$（标准条件下的折射率，15°C，101.325 kPa）
- $P$ 是实际大气压（kPa）
- $P_s = 101.325$ kPa（标准大气压）
- $T$ 是实际温度（K）
- $T_s = 288.15$ K（标准温度）

实际光速：$c_{air} = c_0 / n(T,P,\lambda)$

**计算实例3**：在高原环境（$T = 0°C = 273.15K$，$P = 60 kPa$），折射率为：
$$n = 1 + (1.000293 - 1) \times \frac{60}{101.325} \times \frac{288.15}{273.15} = 1.000183$$

相对于标准条件，折射率变化：
$$\Delta n = 1.000183 - 1.000293 = -0.00011$$

对100米距离的测量影响：
$$\Delta d = 100 \times 0.00011 = 11 \text{ mm}$$

这个例子说明，在要求毫米级精度的应用中，必须进行大气修正。

### 1.1.4 脉冲波形与时间判别

实际的激光脉冲并非理想的狄拉克函数，而是具有一定宽度（通常1-10 ns）的波形。精确的时间判别需要考虑：

1. **上升沿检测**：最简单但易受噪声影响
2. **峰值检测**：稳定但存在系统延迟
3. **恒比定时（CFD）**：在脉冲幅度的固定比例处触发

对于高斯脉冲$p(t) = A \exp[-(t-t_0)^2/(2\sigma^2)]$，恒比定时在$k$倍峰值处触发，时刻为：
$$t_{CFD} = t_0 - \sigma\sqrt{2\ln(1/k)}$$

**计算实例4**：脉冲宽度（FWHM）为5 ns的高斯脉冲，$\sigma = 5/(2\sqrt{2\ln 2}) = 2.12$ ns。
若采用50%恒比定时（$k=0.5$），触发时刻相对峰值的提前量为：
$$\Delta t = \sigma\sqrt{2\ln 2} = 2.12 \times 1.177 = 2.5 \text{ ns}$$

### 1.1.5 多目标分辨能力

当激光束照射到多个不同距离的目标时（如树叶和地面），会产生多个回波。两个目标能被分辨的最小距离差由脉冲宽度决定：

$$\Delta d_{min} = \frac{c \cdot \tau_{pulse}}{2}$$

**计算实例5**：对于3 ns脉冲宽度的激光雷达：
$$\Delta d_{min} = \frac{3 \times 10^8 \times 3 \times 10^{-9}}{2} = 0.45 \text{ m}$$

这意味着距离差小于45厘米的两个目标将无法分辨，它们的回波会叠加成一个脉冲。

### 1.1.6 最大不模糊距离

为了避免距离模糊，必须确保前一个脉冲的回波在下一个脉冲发射前返回。因此最大不模糊距离为：

$$R_{max} = \frac{c}{2f_{rep}}$$

其中$f_{rep}$是脉冲重复频率。

**计算实例6**：若要实现300米的最大探测距离，脉冲重复频率不能超过：
$$f_{rep} = \frac{c}{2R_{max}} = \frac{3 \times 10^8}{2 \times 300} = 500 \text{ kHz}$$

这在系统设计中造成了测程与数据率之间的权衡：更远的测程需要更低的脉冲频率，从而降低了点云密度。

### 1.1.7 信号强度与动态范围

激光雷达接收到的信号强度变化极大。对于朗伯反射面，接收功率与距离平方成反比：

$$P_r = P_t \cdot \frac{\rho A_r}{4\pi R^2} \cdot \eta_{opt}$$

其中：
- $P_t$ 是发射功率
- $\rho$ 是目标反射率（0.05-0.95）
- $A_r$ 是接收孔径面积
- $\eta_{opt}$ 是光学效率

**计算实例7**：发射功率$P_t = 1$ W（峰值），接收孔径直径25 mm，光学效率0.7。
对于反射率0.8的目标：
- 10米处：$P_r = 1 \times \frac{0.8 \times \pi \times 0.0125^2}{4\pi \times 10^2} \times 0.7 = 2.75 \times 10^{-6}$ W
- 100米处：$P_r = 1 \times \frac{0.8 \times \pi \times 0.0125^2}{4\pi \times 100^2} \times 0.7 = 2.75 \times 10^{-8}$ W

动态范围达40 dB，这要求接收器具有大动态范围或自动增益控制（AGC）。

### 1.1.8 背景光抑制

日光是激光雷达的主要干扰源。太阳辐照度在近红外波段约为：
- 905 nm：$E_{sun} \approx 0.7$ W/m²/nm
- 1550 nm：$E_{sun} \approx 0.25$ W/m²/nm

通过窄带滤光片（带宽$\Delta\lambda$）和小接收视场角（FOV）抑制背景光：

$$P_{bg} = E_{sun} \cdot \Delta\lambda \cdot A_r \cdot \Omega_{FOV}$$

其中$\Omega_{FOV} = \pi(\theta_{FOV}/2)^2$是立体角。

**计算实例8**：905 nm激光雷达，滤光片带宽3 nm，接收孔径25 mm，FOV = 0.1°：
$\Omega_{FOV} = \pi \times (0.1 \times \pi/180/2)^2 = 2.39 \times 10^{-6}$ sr

$P_{bg} = 0.7 \times 3 \times \pi \times 0.0125^2 \times 2.39 \times 10^{-6} = 2.47 \times 10^{-9}$ W

这相当于100米目标的回波功率的1/10，说明背景光抑制的重要性。

### 1.1.9 时间抖动与走离误差

实际系统中，触发时刻存在随机抖动（jitter），主要来源包括：
1. 激光器触发抖动：$\sigma_{laser} \approx 10-50$ ps
2. 探测器时间响应：$\sigma_{detector} \approx 50-200$ ps  
3. 电子线路噪声：$\sigma_{circuit} \approx 20-100$ ps

总时间抖动：
$$\sigma_{total} = \sqrt{\sigma_{laser}^2 + \sigma_{detector}^2 + \sigma_{circuit}^2}$$

**计算实例9**：各分量分别为30 ps、100 ps、50 ps：
$\sigma_{total} = \sqrt{30^2 + 100^2 + 50^2} = \sqrt{900 + 10000 + 2500} = 116$ ps

对应距离精度：
$\sigma_d = \frac{c \cdot \sigma_{total}}{2} = \frac{3 \times 10^8 \times 116 \times 10^{-12}}{2} = 17.4$ mm

### 1.1.10 脉冲编码技术

为提高抗干扰能力和多机共存能力，可采用脉冲编码：

**伪随机序列编码**：发射一串编码脉冲，通过相关运算提取回波。
增益因子：$G = \sqrt{N}$，其中$N$是序列长度。

**计算实例10**：使用31位m序列编码，单脉冲能量降低至1/31，但相关增益：
$$G = \sqrt{31} = 5.57$$

信噪比改善：
$SNR_{improvement} = 10\log_{10}(31/5.57^2) = 10\log_{10}(1) = 0$ dB

虽然总SNR不变，但抗干扰能力大幅提升，因为只有相同编码的回波才能通过相关检测。

## 1.2 相干探测原理 (FMCW)

调频连续波（Frequency Modulated Continuous Wave，FMCW）激光雷达采用完全不同的测距原理。它不是测量时间，而是通过测量频率差来计算距离，同时还能直接获得目标的径向速度信息。

### 1.2.1 调频连续波基本原理

FMCW激光雷达发射频率随时间线性变化的连续激光：

$$f(t) = f_0 + kt$$

其中：
- $f_0$ 是起始光频（如193 THz，对应1550 nm）
- $k$ 是调频斜率（Hz/s）
- $t$ 是时间

当发射光遇到距离$R$的目标反射后，接收信号相对发射信号有时间延迟$\tau = 2R/c$。将接收信号与当前发射信号混频，得到拍频：

$$f_b = |f_{trans}(t) - f_{recv}(t)| = |f(t) - f(t-\tau)| = k\tau = \frac{2Rk}{c}$$

**计算实例1**：调频带宽$B = 1$ GHz，调频周期$T = 1$ ms，则调频斜率：
$$k = \frac{B}{T} = \frac{10^9}{10^{-3}} = 10^{12} \text{ Hz/s}$$

对于100米的目标：
$$f_b = \frac{2 \times 100 \times 10^{12}}{3 \times 10^8} = 667 \text{ kHz}$$

### 1.2.2 多普勒效应与速度测量

如果目标以径向速度$v$运动，会产生多普勒频移。完整的拍频公式为：

$$f_b = \frac{2vf_0}{c} + \frac{2Rk}{c}$$

第一项是多普勒频移，第二项是距离引起的频移。通过上下扫频（三角波调制），可以分离这两个分量：

上扫频：$f_{up} = \frac{2vf_0}{c} + \frac{2Rk}{c}$
下扫频：$f_{down} = \frac{2vf_0}{c} - \frac{2Rk}{c}$

解得：
- 距离：$R = \frac{c(f_{up} + f_{down})}{4k}$
- 速度：$v = \frac{c(f_{up} - f_{down})}{4f_0}$

**计算实例2**：$f_0 = 193$ THz（1550 nm），测得$f_{up} = 700$ kHz，$f_{down} = 634$ kHz。
使用上述$k = 10^{12}$ Hz/s：

距离：$R = \frac{3 \times 10^8 \times (700 + 634) \times 10^3}{4 \times 10^{12}} = 100.05$ m

速度：$v = \frac{3 \times 10^8 \times (700 - 634) \times 10^3}{4 \times 193 \times 10^{12}} = 25.65$ m/s

### 1.2.3 相位噪声影响

激光器的相位噪声是FMCW系统的主要噪声源。相位变化导致的距离误差：

$$\Delta R = \frac{c \cdot \Delta\phi}{4\pi f_0}$$

其中$\Delta\phi$是相位噪声（弧度）。

**计算实例3**：对于1550 nm激光（$f_0 = 193$ THz），若相位噪声$\Delta\phi = 0.1$ rad：
$$\Delta R = \frac{3 \times 10^8 \times 0.1}{4\pi \times 193 \times 10^{12}} = 12.4 \text{ μm}$$

这表明FMCW可以达到微米级的测距精度，远超ToF系统。

### 1.2.4 相干长度要求

为了保证良好的相干性，激光器的线宽$\Delta f$必须足够窄。相干长度定义为：

$$L_c = \frac{c}{\pi\Delta f}$$

系统的最大探测距离不能超过相干长度的一半：$R_{max} < L_c/2$

**计算实例4**：要探测200米的目标，激光器线宽需要满足：
$$\Delta f < \frac{c}{\pi \times 2R_{max}} = \frac{3 \times 10^8}{\pi \times 400} = 239 \text{ kHz}$$

这要求使用窄线宽激光器，如外腔半导体激光器（ECDL）或分布反馈激光器（DFB）。

### 1.2.5 线性度要求

调频的非线性会导致拍频展宽，降低距离分辨率。对于线性度误差$\epsilon$（相对于理想线性的偏差），频谱展宽为：

$$\Delta f_b = 2\epsilon \cdot f_b$$

距离分辨率退化为：
$$\delta R = \frac{c}{2B} \cdot (1 + 2\epsilon)$$

**计算实例5**：调频带宽$B = 1$ GHz，理想距离分辨率为：
$$\delta R_{ideal} = \frac{3 \times 10^8}{2 \times 10^9} = 0.15 \text{ m}$$

若线性度误差$\epsilon = 1\%$，实际分辨率：
$$\delta R = 0.15 \times (1 + 0.02) = 0.153 \text{ m}$$

### 1.2.6 信号处理与FFT

实际系统中，拍频信号通过FFT分析。采样率$f_s$必须满足奈奎斯特定理：$f_s > 2f_{b,max}$

FFT的频率分辨率：$\Delta f_{FFT} = f_s/N$，其中$N$是FFT点数。

对应的距离分辨率：
$$\Delta R_{FFT} = \frac{c \cdot \Delta f_{FFT}}{2k} = \frac{c \cdot f_s}{2kN}$$

**计算实例6**：最大探测距离300 m，$k = 10^{12}$ Hz/s，则最大拍频：
$$f_{b,max} = \frac{2 \times 300 \times 10^{12}}{3 \times 10^8} = 2 \text{ MHz}$$

采用$f_s = 5$ MHz，$N = 1024$点FFT：
$$\Delta R_{FFT} = \frac{3 \times 10^8 \times 5 \times 10^6}{2 \times 10^{12} \times 1024} = 0.73 \text{ m}$$

### 1.2.7 相干探测的信噪比分析

FMCW系统的信噪比由本振光功率$P_{LO}$和信号光功率$P_s$决定：

$$SNR = \frac{2\eta P_s P_{LO}}{h\nu B(1 + 2\eta P_{LO}/i_{sat})}$$

其中：
- $\eta$ 是探测器量子效率
- $h\nu$ 是光子能量
- $B$ 是电子带宽
- $i_{sat}$ 是探测器饱和电流

在本振功率足够但未饱和时，简化为：
$$SNR = \frac{2\eta P_s P_{LO}}{h\nu B}$$

**计算实例7**：1550 nm系统，$\eta = 0.8$，$P_s = 1$ nW，$P_{LO} = 1$ mW，$B = 10$ MHz：
$h\nu = \frac{6.626 \times 10^{-34} \times 3 \times 10^8}{1550 \times 10^{-9}} = 1.28 \times 10^{-19}$ J

$$SNR = \frac{2 \times 0.8 \times 10^{-9} \times 10^{-3}}{1.28 \times 10^{-19} \times 10^7} = 1250$$

即31 dB，远高于直接探测。

### 1.2.8 扫频非线性补偿

实际激光器的调频特性存在非线性，可通过辅助干涉仪监测并补偿。设参考干涉仪长度$L_{ref}$，产生拍频：

$$f_{ref}(t) = \frac{2L_{ref}}{c} \cdot \frac{df}{dt}$$

理想情况下$f_{ref}$应为常数。通过重采样使参考信号等间隔，实现非线性校正。

**计算实例8**：$L_{ref} = 10$ m光纤延迟线（折射率1.45），理想扫频率$k = 10^{12}$ Hz/s：
$f_{ref,ideal} = \frac{2 \times 10 \times 1.45}{3 \times 10^8} \times 10^{12} = 96.7$ kHz

若实测$f_{ref}$在90-105 kHz间波动，说明瞬时扫频率变化±8%，需要补偿。

### 1.2.9 多目标分辨与动态范围

FMCW可同时探测多个目标，频率分辨率决定距离分辨能力：

$$\Delta R_{min} = \frac{c}{2B}$$

动态范围受ADC位数和底噪限制。对于N位ADC：
$DR = 6.02N + 1.76 - 10\log_{10}(B/f_s)$ dB

**计算实例9**：调频带宽$B = 2$ GHz，使用12位ADC，采样率$f_s = 10$ MHz：
- 距离分辨率：$\Delta R_{min} = 3 \times 10^8/(2 \times 2 \times 10^9) = 0.075$ m
- 动态范围：$DR = 6.02 \times 12 + 1.76 - 10\log_{10}(2 \times 10^9/10 \times 10^6) = 74 - 23 = 51$ dB

可同时探测强反射（路标）和弱反射（黑色车辆）目标。

### 1.2.10 温度稳定性与波长控制

激光器波长随温度漂移影响测量精度：

$$\frac{d\lambda}{dT} \approx 0.1 \text{ nm/°C}$$（典型DFB激光器）

引起的测距误差：
$$\Delta R = R \cdot \frac{\Delta\lambda}{\lambda}$$

**计算实例10**：100米目标，温度变化10°C，1550 nm激光器：
$\Delta\lambda = 0.1 \times 10 = 1$ nm
$\Delta R = 100 \times \frac{1}{1550} = 64.5$ mm

需要温度控制（TEC）保持mK级稳定性，或使用参考气室进行波长锁定。

## 1.3 雪崩探测原理

雪崩光电二极管（Avalanche Photodiode，APD）是激光雷达接收端的核心器件。通过雪崩倍增效应，APD能够探测极微弱的光信号，这对远距离目标探测至关重要。

### 1.3.1 雪崩增益机理

当APD的反向偏压接近击穿电压$V_{br}$时，光生载流子在强电场下获得足够能量，通过碰撞电离产生新的电子-空穴对，形成雪崩倍增。增益表达式为：

$$M = \frac{1}{1-(V/V_{br})^n}$$

其中：
- $M$ 是雪崩增益
- $V$ 是工作偏压
- $V_{br}$ 是击穿电压
- $n$ 是与材料相关的指数（硅：2-6，InGaAs：2-3）

**计算实例1**：硅APD，$V_{br} = 200$ V，$n = 3$，工作在$V = 190$ V：
$$M = \frac{1}{1-(190/200)^3} = \frac{1}{1-0.857} = 7.0$$

若偏压提高到195 V：
$$M = \frac{1}{1-(195/200)^3} = \frac{1}{1-0.926} = 13.5$$

可见增益对偏压极其敏感，5V的变化导致增益翻倍。

### 1.3.2 过剩噪声因子

雪崩过程的随机性引入额外噪声，用过剩噪声因子$F$描述：

$$F = kM + (1-k)(2-1/M)$$

其中$k$是电离率比（空穴电离率/电子电离率）：
- 硅：$k \approx 0.02$（电子引发雪崩占主导）
- InGaAs：$k \approx 0.4$

信噪比随增益的变化：
$$SNR \propto \frac{M}{\sqrt{F}}$$

**计算实例2**：比较硅和InGaAs APD在$M = 10$时的噪声性能：

硅（$k = 0.02$）：
$$F_{Si} = 0.02 \times 10 + 0.98 \times (2 - 0.1) = 0.2 + 1.86 = 2.06$$

InGaAs（$k = 0.4$）：
$$F_{InGaAs} = 0.4 \times 10 + 0.6 \times 1.9 = 4 + 1.14 = 5.14$$

硅APD的噪声因子更低，但InGaAs在1550 nm波段有更高的量子效率。

### 1.3.3 Geiger模式工作原理

当偏压超过击穿电压时，APD工作在Geiger模式（也称SPAD - Single Photon Avalanche Diode）。单个光子即可触发自持雪崩，产生可检测的电流脉冲。

雪崩必须通过淬灭电路终止，常用被动淬灭：
$$V_{excess} = V - V_{br}$$
$$I_{avalanche} = \frac{V_{excess}}{R_q}$$

其中$R_q$是淬灭电阻（典型值100 kΩ - 1 MΩ）。

**计算实例3**：$V_{br} = 50$ V，$V = 55$ V，$R_q = 200$ kΩ：
$$I_{avalanche} = \frac{5}{200 \times 10^3} = 25 \text{ μA}$$

淬灭时间常数：$\tau_q = R_q C_d$，其中$C_d$是二极管电容（约1 pF）：
$$\tau_q = 200 \times 10^3 \times 10^{-12} = 200 \text{ ns}$$

### 1.3.4 线性模式vs Geiger模式

两种模式的关键区别：

**线性模式**（$V < V_{br}$）：
- 输出与光强成正比
- 可测量脉冲强度
- 动态范围大（>60 dB）
- 时间分辨率受增益带宽积限制

**Geiger模式**（$V > V_{br}$）：
- 单光子灵敏度
- 输出为数字脉冲
- 极高增益（$10^5 - 10^6$）
- 存在死时间

**计算实例4**：比较两种模式的灵敏度。
线性APD：$M = 100$，NEP = 10 pW/√Hz
Geiger模式：单光子探测，$E_{photon} = hc/\lambda = 1.28 \times 10^{-19}$ J（@1550nm）

在1 MHz带宽下：
- 线性模式最小可探测功率：$P_{min} = 10 \times 10^{-12} \times \sqrt{10^6} = 10$ nW
- Geiger模式：可探测单个光子，等效功率 = $1.28 \times 10^{-19} \times 10^6 = 0.128$ pW

Geiger模式灵敏度高出5个数量级。

### 1.3.5 死时间与计数率

SPAD触发后的恢复时间称为死时间$\tau_{dead}$，期间无法探测新光子。最大计数率：

$$R_{max} = \frac{1}{\tau_{dead}}$$

实际计数率与入射光子率的关系（考虑死时间）：
$$R_{out} = \frac{R_{in}}{1 + R_{in}\tau_{dead}}$$

**计算实例5**：$\tau_{dead} = 50$ ns，则$R_{max} = 20$ MHz。
当入射率$R_{in} = 10$ MHz时：
$$R_{out} = \frac{10 \times 10^6}{1 + 10 \times 10^6 \times 50 \times 10^{-9}} = \frac{10}{1.5} = 6.67 \text{ MHz}$$

探测效率降至67%，这种非线性响应需要在高计数率应用中校正。

### 1.3.6 暗计数与后脉冲

即使无光照，热激发也会触发雪崩，产生暗计数。暗计数率（DCR）与温度的关系：
$$DCR \propto \exp(-E_g/2kT)$$

后脉冲由陷阱释放载流子引起，概率随过压增加：
$$P_{ap} = P_0 \exp(V_{excess}/V_0)$$

**计算实例6**：InGaAs SPAD，室温DCR = 10 kHz，制冷到-40°C：
温度从300K降到233K，假设$E_g = 0.75$ eV：
$$\frac{DCR_{233K}}{DCR_{300K}} = \exp\left[\frac{0.75 \times 1.6 \times 10^{-19}}{2 \times 1.38 \times 10^{-23}}\left(\frac{1}{300} - \frac{1}{233}\right)\right]$$
$$= \exp(-2.17) = 0.114$$

制冷后DCR降至1.14 kHz，提高了信噪比。

### 1.3.7 时间相关单光子计数（TCSPC）

TCSPC技术通过累积多次测量构建时间直方图，提取微弱信号：

1. 每个激光脉冲最多记录一个光子到达时间
2. 重复测量建立时间分布
3. 峰值位置对应目标距离

信噪比改善：$SNR_{TCSPC} = \sqrt{N} \cdot SNR_{single}$，其中$N$是累积次数。

**计算实例7**：单次测量SNR = 0.1（信号淹没在噪声中），累积10000次：
$$SNR_{TCSPC} = \sqrt{10000} \times 0.1 = 10$$

从无法探测提升到清晰可见。时间分辨率提升：
$$\sigma_{TCSPC} = \frac{\sigma_{single}}{\sqrt{N}} = \frac{100 \text{ ps}}{\sqrt{10000}} = 1 \text{ ps}$$

对应0.15 mm距离精度。

### 1.3.8 光子数分辨探测

使用多个SPAD组成阵列，可实现光子数分辨：

$$P_n = \binom{M}{n} p^n (1-p)^{M-n}$$

其中$M$是SPAD数量，$p$是单个SPAD触发概率，$n$是触发的SPAD数。

**计算实例8**：16个SPAD阵列，平均入射4个光子，探测效率0.3：
平均触发SPAD数：$\bar{n} = M \cdot (1-e^{-\eta \bar{N}/M}) = 16 \times (1-e^{-0.3 \times 4/16}) = 1.14$

可区分0、1、2、3+光子事件，提供强度信息。

### 1.3.9 APD阵列与SiPM

硅光电倍增管（SiPM）集成数千个Geiger模式APD单元：

总输出：$I_{SiPM} = N_{fired} \times Q_{cell}$

其中$Q_{cell} = C_{cell} \times V_{excess}$是单元电荷。

动态范围：由总单元数决定，典型1000-10000个。

**计算实例9**：3×3 mm² SiPM，单元尺寸50×50 μm²：
- 总单元数：$N_{total} = (3000/50)^2 = 3600$
- 单元电容：$C_{cell} = \epsilon A/d = 8.85 \times 10^{-12} \times (50 \times 10^{-6})^2 / 3 \times 10^{-6} = 7.4$ fF
- 过压5V时单元电荷：$Q_{cell} = 7.4 \times 10^{-15} \times 5 = 3.7 \times 10^{-14}$ C
- 饱和输出：$I_{sat} = 3600 \times 3.7 \times 10^{-14} / 10^{-9} = 0.13$ mA（假设1ns脉冲）

### 1.3.10 增益稳定性与温度补偿

APD增益强烈依赖温度和偏压：

$$\frac{1}{M}\frac{dM}{dT} = -\frac{1}{V_{br}}\frac{dV_{br}}{dT} \approx -0.1\%/°C$$

$$\frac{1}{M}\frac{dM}{dV} = \frac{n}{V_{br}-V} \approx 2-5\%/V$$

**计算实例10**：要保持增益稳定在1%以内：
- 温度控制：$\Delta T < 1/0.1 = 10°C$
- 偏压稳定性：$\Delta V < 1/3 = 0.33$ V（假设3%/V）

实际系统采用查找表补偿：$V_{optimal}(T) = V_{br}(T) - \Delta V_{fixed}$

## 1.4 激光雷达方程

激光雷达方程是系统设计的基础，它定量描述了发射功率、目标特性、大气传输和接收系统之间的关系。

### 1.4.1 基本激光雷达方程

对于硬目标（表面反射），接收功率为：

$$P_r = P_t \cdot \frac{\rho A_r}{4\pi R^2} \cdot \eta_{atm} \cdot \eta_{sys}$$

展开各项：
$$P_r = P_t \cdot \frac{\rho \cdot \pi D_r^2/4}{4\pi R^2} \cdot \exp(-2\alpha R) \cdot \eta_{opt}$$

其中：
- $P_t$：发射峰值功率
- $\rho$：目标反射率（朗伯反射假设）
- $D_r$：接收孔径直径
- $R$：目标距离
- $\alpha$：大气衰减系数
- $\eta_{opt}$：光学系统效率

**计算实例1**：车载激光雷达，$P_t = 10$ W，$D_r = 80$ mm，$\rho = 0.1$（柏油路），$R = 200$ m，晴天$\alpha = 0.15$ km⁻¹：

$$P_r = 10 \times \frac{0.1 \times \pi \times 0.08^2/4}{4\pi \times 200^2} \times \exp(-2 \times 0.15 \times 0.2) \times 0.7$$
$$= 10 \times \frac{5.03 \times 10^{-4}}{5.03 \times 10^5} \times 0.942 \times 0.7 = 6.6 \times 10^{-9}$ W

即6.6 nW，需要高灵敏度探测器。

### 1.4.2 扩展目标与光斑覆盖

当激光光斑大于目标时，需考虑光斑覆盖因子：

$$A_{target} = \pi (R\theta_t/2)^2$$

其中$\theta_t$是发射光束发散角。

修正的雷达方程：
$$P_r = P_t \cdot \frac{\rho A_{overlap}}{4\pi R^2} \cdot \eta_{atm} \cdot \eta_{sys}$$

$A_{overlap} = \min(A_{target}, A_{footprint})$

**计算实例2**：测量50 m处直径10 cm的电线，光束发散角0.3 mrad：
- 光斑直径：$d_{spot} = 50 \times 0.3 \times 10^{-3} = 15$ mm
- 光斑面积：$A_{spot} = \pi \times 0.0075^2 = 1.77 \times 10^{-4}$ m²
- 电线投影面积：$A_{wire} = 0.1 \times 1 = 0.1$ m²（假设1米长）
- 实际照射面积：$A_{overlap} \approx 0.015 \times 0.1 = 1.5 \times 10^{-3}$ m²

仅8.5%的发射能量照射到目标上。

### 1.4.3 大气传输效应

大气衰减包括分子散射和吸收：

$$\tau_{atm} = \exp[-\int_0^R (\alpha_{mol}(z) + \alpha_{aer}(z) + \alpha_{abs}(z))dz]$$

简化为：$\tau_{atm} = \exp(-2\alpha R)$（往返）

不同天气条件的衰减系数（@905nm）：
- 晴天：$\alpha = 0.1-0.2$ km⁻¹
- 轻雾：$\alpha = 1-2$ km⁻¹  
- 浓雾：$\alpha = 10-50$ km⁻¹
- 大雨：$\alpha = 5-10$ km⁻¹

**计算实例3**：比较晴天和雨天100 m处的信号衰减：
- 晴天：$\tau_{clear} = \exp(-2 \times 0.15 \times 0.1) = 0.970$（3%损失）
- 大雨：$\tau_{rain} = \exp(-2 \times 7 \times 0.1) = 0.247$（75%损失）

雨天接收功率降低4倍，严重影响探测距离。
