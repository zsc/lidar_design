<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="./">
    <title>Chapter 11: å¤šä¼ æ„Ÿå™¨èåˆç®—æ³•</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/highlight.css">
    <script src="assets/script.js" defer></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']],
                processEscapes: false,
                packages: {'[+]': ['noerrors', 'ams']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/ams']
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>ç›®å½•</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <div class="sidebar-search">
                <input type="text" id="sidebar-search-input" placeholder="æœç´¢..." autocomplete="off">
            </div>
            <div id="tree-container">
                <nav class="tree-nav" role="tree">
                    <div class="tree-item " >
                        <a href="index.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ¿€å…‰é›·è¾¾å®Œæ•´æŠ€æœ¯æ•™ç¨‹</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter1.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 1: æ¿€å…‰é›·è¾¾åŸºç¡€åŸç†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter2.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 2: æ¿€å…‰é›·è¾¾æŠ€æœ¯å‘å±•ä¸ä¸»è¦å‚å•†</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter3.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 3: æ¿€å…‰é›·è¾¾ç±»å‹ä¸æ‰«ææœºåˆ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter4.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 4: æ¿€å…‰é›·è¾¾åˆ¶é€ æŠ€æœ¯</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter5.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 5: ä¿¡å·å¤„ç†ä¸æ—¶åºæ§åˆ¶</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter6.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 6: è¯¯å·®æºåˆ†æï¼ˆéä¿¡å·å¤„ç†ï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter7.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 7: æ¿€å…‰é›·è¾¾ç‹¬ç‰¹ä¼˜åŠ¿ä¸æ€§èƒ½æé™</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter8.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 8: ç‚¹äº‘å¤„ç†åŸºç¡€ç®—æ³•</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter9.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 9: é«˜çº§ç‚¹äº‘ç®—æ³•</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter10.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 10: æ ‡å®šæŠ€æœ¯</span>
                        </a>
                    </div>
                
                    <div class="tree-item active" >
                        <a href="chapter11.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 11: å¤šä¼ æ„Ÿå™¨èåˆç®—æ³•</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter12.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 12: è‡ªåŠ¨é©¾é©¶ä¸“ç”¨ç« èŠ‚</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter13.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 13: æœºå™¨äººåº”ç”¨ï¼ˆäººå½¢ä¸ä»“å‚¨ï¼‰</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="chapter14.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">Chapter 14: å…¶ä»–åº”ç”¨é¢†åŸŸ</span>
                        </a>
                    </div>
                
                    <div class="tree-item " >
                        <a href="CLAUDE.html" class="tree-link">
                            <span class="tree-icon">ğŸ“„</span>
                            <span class="tree-title">æ¿€å…‰é›·è¾¾æ•™ç¨‹é¡¹ç›®è¯´æ˜</span>
                        </a>
                    </div>
                </nav>
            </div>
        </nav>
        
        <main class="content">
            <article>
                <h1 id="chapter-11">Chapter 11: å¤šä¼ æ„Ÿå™¨èåˆç®—æ³•</h1>
<p>åœ¨ç°å®åº”ç”¨ä¸­ï¼Œå•ä¸€ä¼ æ„Ÿå™¨å¾€å¾€æ— æ³•æ»¡è¶³å¤æ‚ç¯å¢ƒä¸‹çš„æ„ŸçŸ¥éœ€æ±‚ã€‚æ¿€å…‰é›·è¾¾è™½ç„¶å…·æœ‰é«˜ç²¾åº¦æµ‹è·èƒ½åŠ›ï¼Œä½†åœ¨çº¹ç†ä¿¡æ¯ã€é€Ÿåº¦æµ‹é‡ã€å…¨å¤©å€™å·¥ä½œç­‰æ–¹é¢å­˜åœ¨å±€é™ã€‚æœ¬ç« å°†è¯¦ç»†ä»‹ç»æ¿€å…‰é›·è¾¾ä¸å…¶ä»–ä¼ æ„Ÿå™¨çš„èåˆç®—æ³•ï¼ŒåŒ…æ‹¬ç›¸æœºã€æ¯«ç±³æ³¢é›·è¾¾ã€IMUå’ŒGPSçš„èåˆæ–¹æ³•ï¼Œä»¥åŠåœ¨å®é™…åº”ç”¨ä¸­çš„æ ‡å®šã€åŒæ­¥å’Œæ•°æ®å…³è”æŠ€æœ¯ã€‚é€šè¿‡å¤šä¼ æ„Ÿå™¨èåˆï¼Œæˆ‘ä»¬å¯ä»¥å®ç°äº’è¡¥ä¼˜åŠ¿ï¼Œæé«˜æ„ŸçŸ¥ç³»ç»Ÿçš„é²æ£’æ€§å’Œå‡†ç¡®æ€§ã€‚</p>
<h2 id="111">11.1 æ¿€å…‰é›·è¾¾+ç›¸æœºèåˆ</h2>
<p>æ¿€å…‰é›·è¾¾ä¸ç›¸æœºçš„èåˆæ˜¯æœ€å¸¸è§çš„å¤šä¼ æ„Ÿå™¨ç»„åˆï¼Œç»“åˆäº†æ¿€å…‰é›·è¾¾çš„ç²¾ç¡®æ·±åº¦ä¿¡æ¯å’Œç›¸æœºçš„ä¸°å¯Œçº¹ç†ä¿¡æ¯ã€‚è¿™ç§èåˆåœ¨è‡ªåŠ¨é©¾é©¶ã€æœºå™¨äººå¯¼èˆªå’Œä¸‰ç»´é‡å»ºç­‰é¢†åŸŸå…·æœ‰å¹¿æ³›åº”ç”¨ã€‚</p>
<h3 id="1111">11.1.1 æŠ•å½±çŸ©é˜µä¸åæ ‡è½¬æ¢</h3>
<p>å°†æ¿€å…‰é›·è¾¾ç‚¹äº‘æŠ•å½±åˆ°ç›¸æœºå›¾åƒéœ€è¦ç»è¿‡å¤šä¸ªåæ ‡ç³»è½¬æ¢ï¼Œç†è§£è¿™äº›è½¬æ¢çš„æ•°å­¦åŸç†è‡³å…³é‡è¦ã€‚</p>
<p><strong>åæ ‡ç³»å®šä¹‰ï¼š</strong></p>
<ul>
<li>æ¿€å…‰é›·è¾¾åæ ‡ç³»ï¼šXè½´å‘å‰ï¼ŒYè½´å‘å·¦ï¼ŒZè½´å‘ä¸Šï¼ˆå³æ‰‹ç³»ï¼‰</li>
<li>ç›¸æœºåæ ‡ç³»ï¼šXè½´å‘å³ï¼ŒYè½´å‘ä¸‹ï¼ŒZè½´å‘å‰ï¼ˆå…‰è½´æ–¹å‘ï¼‰</li>
<li>å›¾åƒåæ ‡ç³»ï¼šåŸç‚¹åœ¨å·¦ä¸Šè§’ï¼Œuè½´å‘å³ï¼Œvè½´å‘ä¸‹</li>
</ul>
<p><strong>æ¿€å…‰é›·è¾¾åæ ‡ç³»åˆ°ç›¸æœºåæ ‡ç³»ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">P_camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R_lidar_to_camera</span><span class="w"> </span><span class="err">Â·</span><span class="w"> </span><span class="n">P_lidar</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t_lidar_to_camera</span>
</code></pre></div>

<p>å…¶ä¸­Ræ˜¯3Ã—3æ—‹è½¬çŸ©é˜µï¼Œtæ˜¯3Ã—1å¹³ç§»å‘é‡ã€‚æ—‹è½¬çŸ©é˜µå¯é€šè¿‡æ¬§æ‹‰è§’æˆ–å››å…ƒæ•°è¡¨ç¤ºï¼š</p>
<p>æ¬§æ‹‰è§’è¡¨ç¤ºï¼ˆZYXé¡ºåºï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>R = R_z(yaw) Â· R_y(pitch) Â· R_x(roll)

R_x(Ï†) = [1    0       0    ]
         [0  cos(Ï†) -sin(Ï†)]
         [0  sin(Ï†)  cos(Ï†)]

R_y(Î¸) = [ cos(Î¸)  0  sin(Î¸)]
         [   0     1    0   ]
         [-sin(Î¸)  0  cos(Î¸)]

R_z(Ïˆ) = [cos(Ïˆ) -sin(Ïˆ)  0]
         [sin(Ïˆ)  cos(Ïˆ)  0]
         [  0       0      1]
</code></pre></div>

<p><strong>ç›¸æœºåæ ‡ç³»åˆ°å›¾åƒåæ ‡ç³»ï¼š</strong>
é€è§†æŠ•å½±æ¨¡å‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">Î»</span><span class="o">[</span><span class="n">u</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">fx  s  cx</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">X_camera</span><span class="o">]</span>
<span class="w"> </span><span class="o">[</span><span class="n">v</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">0  fy  cy</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">Y_camera</span><span class="o">]</span>
<span class="w"> </span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="w">   </span><span class="o">[</span><span class="n">0   0   1</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">Z_camera</span><span class="o">]</span>
</code></pre></div>

<p>å…¶ä¸­ï¼š</p>
<ul>
<li>fx, fyï¼šç„¦è·ï¼ˆåƒç´ å•ä½ï¼‰</li>
<li>cx, cyï¼šä¸»ç‚¹åæ ‡</li>
<li>sï¼šå€¾æ–œå‚æ•°ï¼ˆé€šå¸¸ä¸º0ï¼‰</li>
<li>Î» = Z_cameraï¼šæ·±åº¦å€¼</li>
</ul>
<p><strong>ç•¸å˜æ ¡æ­£ï¼š</strong>
å®é™…ç›¸æœºå­˜åœ¨å¾„å‘å’Œåˆ‡å‘ç•¸å˜ï¼š</p>
<div class="codehilite"><pre><span></span><code>å¾„å‘ç•¸å˜ï¼š
x_distorted = x(1 + k1Â·rÂ² + k2Â·râ´ + k3Â·râ¶)
y_distorted = y(1 + k1Â·rÂ² + k2Â·râ´ + k3Â·râ¶)

åˆ‡å‘ç•¸å˜ï¼š
x_distorted = x + 2p1Â·xy + p2(rÂ² + 2xÂ²)
y_distorted = y + p1(rÂ² + 2yÂ²) + 2p2Â·xy
</code></pre></div>

<p>å…¶ä¸­rÂ² = xÂ² + yÂ²ï¼Œ(x,y)æ˜¯å½’ä¸€åŒ–ç›¸æœºåæ ‡ã€‚</p>
<p><strong>å®Œæ•´æŠ•å½±æµç¨‹ï¼š</strong></p>
<ol>
<li>3Dç‚¹ä»æ¿€å…‰é›·è¾¾åæ ‡ç³»è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³»</li>
<li>æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨ç›¸æœºå‰æ–¹ï¼ˆZ_camera &gt; 0ï¼‰</li>
<li>å½’ä¸€åŒ–ï¼šx = X_camera/Z_camera, y = Y_camera/Z_camera</li>
<li>åº”ç”¨ç•¸å˜æ¨¡å‹</li>
<li>æŠ•å½±åˆ°åƒç´ åæ ‡</li>
</ol>
<p><strong>è®¡ç®—å®ä¾‹1ï¼ˆæ ‡å‡†æƒ…å†µï¼‰ï¼š</strong>
æ¿€å…‰é›·è¾¾ç‚¹P_lidar = [10, 2, -0.5]^T (m)ï¼Œå¤–å‚æ ‡å®šç»“æœï¼š</p>
<ul>
<li>æ—‹è½¬è§’ï¼šroll=0Â°, pitch=5Â°, yaw=0Â°</li>
<li>å¹³ç§»ï¼št = [0.1, 0, 0.2]^T (m)</li>
<li>ç›¸æœºå†…å‚ï¼šfx=fy=1000, cx=640, cy=360</li>
<li>ç•¸å˜ç³»æ•°ï¼šk1=-0.1, k2=0.05, p1=p2=0</li>
</ul>
<p>è®¡ç®—è¿‡ç¨‹ï¼š</p>
<ol>
<li>æ„å»ºæ—‹è½¬çŸ©é˜µï¼ˆpitch=5Â°â‰ˆ0.0873radï¼‰ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>R = [1      0         0     ]
    [0   0.9962   -0.0872 ]
    [0   0.0872    0.9962 ]
</code></pre></div>

<ol start="2">
<li>è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³»ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">P_camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="err">Â·</span><span class="n">P_lidar</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">t</span>
<span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">10.1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.036</span><span class="p">,</span><span class="w"> </span><span class="mf">0.674</span><span class="p">]</span><span class="err">^</span><span class="n">T</span>
</code></pre></div>

<ol start="3">
<li>å½’ä¸€åŒ–åæ ‡ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>x = 10.1/0.674 = 14.985
y = 2.036/0.674 = 3.021
</code></pre></div>

<ol start="4">
<li>ç•¸å˜æ ¡æ­£ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>rÂ² = 14.985Â² + 3.021Â² = 233.65
ç•¸å˜å› å­ = 1 + (-0.1)Ã—233.65 + 0.05Ã—233.65Â² = -729.8
</code></pre></div>

<p>æç«¯ç•¸å˜è¡¨æ˜ç‚¹åœ¨å›¾åƒè¾¹ç¼˜ï¼Œéœ€è¦æ›´åˆç†çš„å‚æ•°ã€‚</p>
<p><strong>è®¡ç®—å®ä¾‹2ï¼ˆå®é™…è½¦è½½åœºæ™¯ï¼‰ï¼š</strong>
æ¿€å…‰é›·è¾¾æ£€æµ‹åˆ°å‰æ–¹è½¦è¾†ç‚¹P_lidar = [20, -1.5, 0.8]^Tï¼š</p>
<ul>
<li>å¤–å‚ï¼šroll=0.5Â°, pitch=-2Â°, yaw=1Â°</li>
<li>å¹³ç§»ï¼št = [0.05, -0.08, 0.15]^T</li>
<li>å†…å‚ï¼šfx=1200, fy=1200, cx=960, cy=540</li>
</ul>
<p>è¯¦ç»†è®¡ç®—ï¼š</p>
<ol>
<li>ç»„åˆæ—‹è½¬çŸ©é˜µï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>R = [ 0.9997  -0.0175   0.0174]
    [ 0.0178   0.9996  -0.0087]
    [-0.0171   0.0093   0.9998]
</code></pre></div>

<ol start="2">
<li>åæ ‡è½¬æ¢ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">P_camera</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mf">20.02</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.45</span><span class="p">,</span><span class="w"> </span><span class="mf">0.51</span><span class="p">]</span><span class="err">^</span><span class="n">T</span>
</code></pre></div>

<ol start="3">
<li>æŠ•å½±ï¼ˆå¿½ç•¥ç•¸å˜ï¼‰ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>u = 1200Ã—20.02/0.51 + 960 = 48082
v = 1200Ã—(-1.45)/0.51 + 540 = -2872
</code></pre></div>

<p>ç‚¹åœ¨å›¾åƒèŒƒå›´å¤–ï¼Œè¯´æ˜éœ€è¦æ›´å¤§çš„è§†åœºè§’ç›¸æœºã€‚</p>
<p><strong>è¾¹ç•Œæ¡ä»¶å¤„ç†ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">project_lidar_to_image</span><span class="p">(</span><span class="n">P_lidar</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dist_coeffs</span><span class="p">,</span> <span class="n">img_width</span><span class="p">,</span> <span class="n">img_height</span><span class="p">):</span>
    <span class="c1"># è½¬æ¢åˆ°ç›¸æœºåæ ‡ç³»</span>
    <span class="n">P_cam</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">P_lidar</span> <span class="o">+</span> <span class="n">t</span>

    <span class="c1"># æ£€æŸ¥æ·±åº¦</span>
    <span class="k">if</span> <span class="n">P_cam</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># ç‚¹åœ¨ç›¸æœºåæ–¹</span>

    <span class="c1"># å½’ä¸€åŒ–</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">P_cam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">P_cam</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P_cam</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">P_cam</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># ç•¸å˜æ ¡æ­£</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span>
    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># é˜²æ­¢æ•°å€¼æº¢å‡º</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># æŠ•å½±</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># è¾¹ç•Œæ£€æŸ¥</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">img_width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">img_height</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>

<h3 id="1112">11.1.2 æ—¶é—´åŒæ­¥ç­–ç•¥</h3>
<p>æ¿€å…‰é›·è¾¾å’Œç›¸æœºçš„é‡‡æ ·é¢‘ç‡ä¸åŒï¼Œéœ€è¦ç²¾ç¡®çš„æ—¶é—´åŒæ­¥ã€‚æ—¶é—´ä¸åŒæ­¥ä¼šå¯¼è‡´è¿åŠ¨ç‰©ä½“çš„é”™ä½ï¼Œä¸¥é‡å½±å“èåˆç²¾åº¦ã€‚</p>
<p><strong>ä¼ æ„Ÿå™¨æ—¶åºç‰¹æ€§ï¼š</strong></p>
<ul>
<li>æ¿€å…‰é›·è¾¾ï¼šè¿ç»­æ—‹è½¬æ‰«æï¼Œæ¯ä¸ªç‚¹æœ‰ç‹¬ç«‹æ—¶é—´æˆ³</li>
<li>ç›¸æœºï¼šç¦»æ•£é‡‡æ ·ï¼Œæ•´å¸§æˆ–é€è¡Œæ›å…‰</li>
<li>å…¸å‹é¢‘ç‡ï¼šæ¿€å…‰é›·è¾¾10-20Hzï¼Œç›¸æœº30-60Hz</li>
</ul>
<p><strong>ç¡¬ä»¶åŒæ­¥æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li><strong>PPSï¼ˆPulse Per Secondï¼‰åŒæ­¥ï¼š</strong>
   - GPSæä¾›1Hzè„‰å†²ä¿¡å·ï¼Œç²¾åº¦Â±50ns
   - æ‰€æœ‰ä¼ æ„Ÿå™¨é”å®šåˆ°åŒä¸€PPSæº
   - æ—¶é—´æˆ³æ ¼å¼ï¼šGPSæ—¶é—´ + äºšç§’åç§»</li>
</ol>
<div class="codehilite"><pre><span></span><code>t_sensor = t_GPS_week Ã— 604800 + t_GPS_second + Î”t_subsecond
</code></pre></div>

<ol start="2">
<li><strong>ä¸»ä»è§¦å‘æ¨¡å¼ï¼š</strong>
   - æ¿€å…‰é›·è¾¾ä½œä¸ºä¸»è®¾å¤‡ï¼Œè¾“å‡ºåŒæ­¥è„‰å†²
   - ç›¸æœºæ¥æ”¶è§¦å‘ä¿¡å·ï¼Œå»¶è¿ŸÎ”tåæ›å…‰
   - è§¦å‘å»¶è¿Ÿè®¡ç®—ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>Î”t_trigger = t_lidar_center - t_exposure/2 - t_trigger_delay
</code></pre></div>

<ol start="3">
<li><strong>IEEE 1588 PTPåŒæ­¥ï¼š</strong>
   - ç²¾ç¡®æ—¶é—´åè®®ï¼Œç²¾åº¦å¯è¾¾äºšå¾®ç§’çº§
   - ä¸»æ—¶é’Ÿå¹¿æ’­ï¼Œä»è®¾å¤‡åŒæ­¥
   - å»¶è¿Ÿè¡¥å¿ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>t_offset = (t_m2 - t_m1 + t_s1 - t_s2) / 2
t_delay = (t_m2 - t_m1 + t_s2 - t_s1) / 2
</code></pre></div>

<p><strong>è½¯ä»¶åŒæ­¥ç®—æ³•ï¼š</strong></p>
<ol>
<li><strong>æœ€è¿‘é‚»åŒ¹é…ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">find_nearest_timestamp</span><span class="p">(</span><span class="n">target_time</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">):</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">target_time</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">before</span> <span class="o">=</span> <span class="n">timestamps</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">after</span> <span class="o">=</span> <span class="n">timestamps</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">after</span> <span class="o">-</span> <span class="n">target_time</span> <span class="o">&lt;</span> <span class="n">target_time</span> <span class="o">-</span> <span class="n">before</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">idx</span>
    <span class="k">return</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span>
</code></pre></div>

<ol start="2">
<li><strong>çº¿æ€§æ’å€¼ï¼š</strong>
   å¯¹äºè¿åŠ¨è¡¥å¿ï¼Œéœ€è¦æ’å€¼ä¼ æ„Ÿå™¨ä½å§¿ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>Î± = (t_target - t_before) / (t_after - t_before)
P_interpolated = (1 - Î±) Ã— P_before + Î± Ã— P_after
R_interpolated = Slerp(R_before, R_after, Î±)
</code></pre></div>

<p>å…¶ä¸­Slerpæ˜¯çƒé¢çº¿æ€§æ’å€¼ï¼š
   <code>Slerp(q0, q1, Î±) = sin((1-Î±)Î©)/sin(Î©) Ã— q0 + sin(Î±Î©)/sin(Î©) Ã— q1
   Î© = arccos(q0Â·q1)</code></p>
<p><strong>æ›å…‰æ¨¡å‹è¯¦è§£ï¼š</strong></p>
<ol>
<li><strong>å…¨å±€å¿«é—¨ï¼ˆGlobal Shutterï¼‰ï¼š</strong>
   - æ‰€æœ‰åƒç´ åŒæ—¶æ›å…‰
   - æ—¶é—´æˆ³å¯¹åº”æ›å…‰ä¸­å¿ƒï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>t_center = t_trigger + t_delay + t_exposure/2
</code></pre></div>

<p>è¿åŠ¨æ¨¡ç³Šæ¨¡å‹ï¼š
   <code>I_blur = âˆ«[0 to t_exp] I(t) dt / t_exposure</code></p>
<ol start="2">
<li><strong>å·å¸˜å¿«é—¨ï¼ˆRolling Shutterï¼‰ï¼š</strong>
   - é€è¡Œæ‰«æï¼Œäº§ç”Ÿæœå†»æ•ˆåº”
   - æ¯è¡Œæ—¶é—´æˆ³ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>t_row(y) = t_start + (y/H) Ã— t_readout
t_readout â‰ˆ 1/fps - t_exposure
</code></pre></div>

<p>ç•¸å˜æ ¡æ­£ï¼š
   <code>å¯¹äºæ¯è¡Œyï¼š
   Î”t = t_row(y) - t_reference
   x_corrected = x - v_x Ã— Î”t</code></p>
<p><strong>æ—¶é—´åŒæ­¥è´¨é‡è¯„ä¼°ï¼š</strong></p>
<ol>
<li><strong>åŒæ­¥è¯¯å·®æµ‹é‡ï¼š</strong>
   ä½¿ç”¨æ—‹è½¬æ ‡å®šæ¿ï¼Œè®¡ç®—æŠ•å½±è¯¯å·®ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>Îµ_sync = ||P_projected - P_detected||
</code></pre></div>

<p>ç†è®ºè¯¯å·®æ¨¡å‹ï¼š
   <code>Îµ = v Ã— Î”t_sync + Ï‰ Ã— r Ã— Î”t_sync</code>
   å…¶ä¸­væ˜¯çº¿é€Ÿåº¦ï¼ŒÏ‰æ˜¯è§’é€Ÿåº¦ï¼Œræ˜¯åˆ°æ—‹è½¬ä¸­å¿ƒè·ç¦»ã€‚</p>
<ol start="2">
<li><strong>å®ä¾‹è®¡ç®—ï¼š</strong>
   è½¦è¾†ä»¥20m/sè¡Œé©¶ï¼Œç›¸æœº30Hzï¼Œæ¿€å…‰é›·è¾¾10Hzï¼š</li>
</ol>
<ul>
<li>æœ€å¤§æ—¶é—´å·®ï¼š1/10 = 100ms</li>
<li>ä¸åŒæ­¥æœ€å¤§è¯¯å·®ï¼š20 Ã— 0.1 = 2m</li>
<li>ä½¿ç”¨æ’å€¼åï¼šè¯¯å·® &lt; 20 Ã— 0.001 = 2cm</li>
</ul>
<p><strong>å¤šä¼ æ„Ÿå™¨æ—¶é—´å¯¹é½æµç¨‹ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">MultiSensorSync</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sync_tolerance</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>  <span class="c1"># 50mså®¹å·®</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync_tolerance</span> <span class="o">=</span> <span class="n">sync_tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_queues</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">add_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sensor_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sensor_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_queues</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_queues</span><span class="p">[</span><span class="n">sensor_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sensor_queues</span><span class="p">[</span><span class="n">sensor_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">try_sync</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">try_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sensor_queues</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># æ‰¾åˆ°æœ€æ–°çš„å…±åŒæ—¶é—´æˆ³</span>
        <span class="n">latest_times</span> <span class="o">=</span> <span class="p">{</span><span class="n">sid</span><span class="p">:</span> <span class="n">q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_queues</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">q</span><span class="p">}</span>
        <span class="n">sync_time</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">latest_times</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="c1"># æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ä¼ æ„Ÿå™¨éƒ½æœ‰æ¥è¿‘çš„æ•°æ®</span>
        <span class="n">synced_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">queue</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensor_queues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">closest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_closest</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">sync_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">closest</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">sync_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sync_tolerance</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">synced_data</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">sync_time</span><span class="p">,</span> <span class="n">synced_data</span>
</code></pre></div>

<h3 id="1113-pointpainting">11.1.3 ç‰¹å¾çº§èåˆ - PointPainting</h3>
<p>PointPaintingæ˜¯ä¸€ç§æœ‰æ•ˆçš„ç‰¹å¾çº§èåˆæ–¹æ³•ï¼Œå°†å›¾åƒè¯­ä¹‰ä¿¡æ¯"ç»˜åˆ¶"åˆ°ç‚¹äº‘ä¸Šï¼Œæ˜¾è‘—æå‡3Dæ£€æµ‹æ€§èƒ½ã€‚</p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<p>PointPaintingåˆ©ç”¨æˆç†Ÿçš„2Dè¯­ä¹‰åˆ†å‰²ç½‘ç»œå¢å¼º3Dç‚¹äº‘ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°†æ¯ä¸ª3Dç‚¹æŠ•å½±åˆ°å›¾åƒå¹³é¢ï¼Œè·å–å¯¹åº”åƒç´ çš„è¯­ä¹‰ä¿¡æ¯ï¼Œç„¶åå°†è¿™äº›ä¿¡æ¯ä½œä¸ºé¢å¤–ç‰¹å¾é™„åŠ åˆ°ç‚¹äº‘ä¸Šã€‚</p>
<p><strong>è¯¦ç»†æµç¨‹ï¼š</strong></p>
<ol>
<li><strong>å›¾åƒè¯­ä¹‰åˆ†å‰²ï¼š</strong>
   ä½¿ç”¨é¢„è®­ç»ƒçš„è¯­ä¹‰åˆ†å‰²ç½‘ç»œï¼ˆå¦‚DeepLabã€Mask R-CNNï¼‰ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>è¾“å…¥ï¼šRGBå›¾åƒ I âˆˆ R^(HÃ—WÃ—3)
è¾“å‡ºï¼šè¯­ä¹‰æ¦‚ç‡å›¾ S âˆˆ R^(HÃ—WÃ—C)
å…¶ä¸­Cæ˜¯ç±»åˆ«æ•°ï¼ŒS[i,j,k]è¡¨ç¤ºåƒç´ (i,j)å±äºç±»åˆ«kçš„æ¦‚ç‡
</code></pre></div>

<ol start="2">
<li><strong>ç‚¹äº‘æŠ•å½±ä¸è¯­ä¹‰æ˜ å°„ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">point_painting</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">seg_model</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># è¯­ä¹‰åˆ†å‰²</span>
    <span class="n">semantic_probs</span> <span class="o">=</span> <span class="n">seg_model</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>  <span class="c1"># HÃ—WÃ—C</span>

    <span class="c1"># åˆå§‹åŒ–å¢å¼ºç‰¹å¾</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="n">semantic_probs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">painted_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">num_classes</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
        <span class="c1"># æŠ•å½±åˆ°å›¾åƒ</span>
        <span class="n">p_cam</span> <span class="o">=</span> <span class="n">R</span> <span class="o">@</span> <span class="n">point</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span>
        <span class="k">if</span> <span class="n">p_cam</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">u</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_cam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">p_cam</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">p_cam</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">p_cam</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">painted_features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">semantic_probs</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">]</span>

    <span class="c1"># æ‹¼æ¥åŸå§‹ç‚¹äº‘å’Œè¯­ä¹‰ç‰¹å¾</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">points</span><span class="p">,</span> <span class="n">painted_features</span><span class="p">])</span>
</code></pre></div>

<ol start="3">
<li><strong>ç‰¹å¾ç¼–ç ç­–ç•¥ï¼š</strong></li>
</ol>
<p>a) <strong>One-hotç¼–ç ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">class_id</span> = <span class="n">argmax</span>(<span class="n">semantic_probs</span>)
<span class="n">one_hot</span> = [<span class="mi">0</span>, ..., <span class="mi">1</span>, ..., <span class="mi">0</span>]  <span class="c1"># ä»…class_idä½ç½®ä¸º1</span>
</code></pre></div>

<p>b) <strong>æ¦‚ç‡åˆ†å¸ƒç¼–ç ï¼š</strong>
   <code>features = semantic_probs  # ä¿ç•™æ‰€æœ‰ç±»åˆ«æ¦‚ç‡</code></p>
<p>c) <strong>Top-kç¼–ç ï¼š</strong>
   <code>top_k_classes = argsort(semantic_probs)[-k:]
   features = [class_ids, probabilities]</code></p>
<ol start="4">
<li><strong>å¤„ç†æŠ•å½±æ­§ä¹‰ï¼š</strong></li>
</ol>
<p>å¤šä¸ªç‚¹å¯èƒ½æŠ•å½±åˆ°åŒä¸€åƒç´ ï¼Œéœ€è¦æ·±åº¦æ’åºï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">resolve_projection_ambiguity</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">projections</span><span class="p">):</span>
    <span class="n">pixel_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">projections</span><span class="p">):</span>
        <span class="n">pixel_dict</span><span class="p">[(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">depth</span><span class="p">))</span>

    <span class="c1"># ä¿ç•™æœ€è¿‘çš„ç‚¹</span>
    <span class="n">valid_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">pixel</span><span class="p">,</span> <span class="n">point_list</span> <span class="ow">in</span> <span class="n">pixel_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">nearest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">point_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">valid_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nearest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">valid_indices</span>
</code></pre></div>

<p><strong>æ€§èƒ½ä¼˜åŒ–ï¼š</strong></p>
<ol>
<li><strong>æ‰¹å¤„ç†æŠ•å½±ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="c1"># å‘é‡åŒ–æŠ•å½±è®¡ç®—</span>
<span class="n">P_cam</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">@</span> <span class="n">points</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">t</span>
<span class="n">valid_mask</span> <span class="o">=</span> <span class="n">P_cam</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">P_cam</span> <span class="o">=</span> <span class="n">P_cam</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">]</span>

<span class="n">uv</span> <span class="o">=</span> <span class="n">K</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">@</span> <span class="n">P_cam</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">P_cam</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">K</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div>

<ol start="2">
<li><strong>GPUåŠ é€Ÿï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="kr">__global__</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">projectPoints</span><span class="p">(</span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">points</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">RT</span><span class="p">,</span><span class="w"> </span>
<span class="w">                              </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">uv_coords</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">num_points</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">blockIdx</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">blockDim</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">threadIdx</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">idx</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">num_points</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 3Då˜æ¢</span>
<span class="w">    </span><span class="kt">float3</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_float3</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="o">*</span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">points</span><span class="p">[</span><span class="n">idx</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">]);</span>
<span class="w">    </span><span class="kt">float3</span><span class="w"> </span><span class="n">p_cam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">matmul</span><span class="p">(</span><span class="n">RT</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p_cam</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">uv_coords</span><span class="p">[</span><span class="n">idx</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p_cam</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">p_cam</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">K</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">        </span><span class="n">uv_coords</span><span class="p">[</span><span class="n">idx</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">K</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">p_cam</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">p_cam</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">K</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>å®éªŒéªŒè¯ï¼š</strong></p>
<p>åœ¨KITTIæ•°æ®é›†ä¸Šçš„æ€§èƒ½æå‡ï¼š</p>
<ul>
<li>åŸºçº¿ï¼ˆä»…ç‚¹äº‘ï¼‰ï¼šCar AP@0.7 = 79.8%</li>
<li>PointPaintingï¼šCar AP@0.7 = 82.1% (+2.3%)</li>
<li>å¯¹å°ç‰©ä½“æå‡æ›´æ˜æ˜¾ï¼šPedestrian APæå‡+4.5%</li>
</ul>
<p><strong>æ‰©å±•åº”ç”¨ï¼š</strong></p>
<ol>
<li><strong>å®ä¾‹çº§PointPaintingï¼š</strong>
   ä½¿ç”¨å®ä¾‹åˆ†å‰²æ›¿ä»£è¯­ä¹‰åˆ†å‰²ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>features = [semantic_class, instance_id, confidence]
</code></pre></div>

<ol start="2">
<li><strong>æ—¶åºPointPaintingï¼š</strong>
   èåˆå¤šå¸§è¯­ä¹‰ä¿¡æ¯ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>semantic_t = Î± Ã— semantic_t + (1-Î±) Ã— semantic_{t-1}
</code></pre></div>

<ol start="3">
<li><strong>è‡ªç›‘ç£PointPaintingï¼š</strong>
   ä½¿ç”¨ä¼ªæ ‡ç­¾è®­ç»ƒï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>pseudo_labels = threshold(teacher_model(image), Ï„)
painted_points = point_painting(points, pseudo_labels)
</code></pre></div>

<h3 id="1114">11.1.4 æ·±åº¦è¡¥å…¨ç®—æ³•</h3>
<p>ç›¸æœºå›¾åƒç¼ºä¹æ·±åº¦ä¿¡æ¯ï¼Œè€Œæ¿€å…‰é›·è¾¾ç‚¹äº‘ç¨€ç–ï¼ˆ64çº¿æ¿€å…‰é›·è¾¾ä»…è¦†ç›–çº¦5%çš„å›¾åƒåƒç´ ï¼‰ï¼Œæ·±åº¦è¡¥å…¨æ—¨åœ¨ç”Ÿæˆç¨ å¯†æ·±åº¦å›¾ï¼Œè¿™å¯¹äºè®¸å¤šä¸‹æ¸¸ä»»åŠ¡å¦‚3Dé‡å»ºã€å¢å¼ºç°å®ç­‰è‡³å…³é‡è¦ã€‚</p>
<p><strong>é—®é¢˜å®šä¹‰ï¼š</strong></p>
<ul>
<li>è¾“å…¥ï¼šç¨€ç–æ·±åº¦å›¾D_sparse âˆˆ R^(HÃ—W)ï¼ŒRGBå›¾åƒI âˆˆ R^(HÃ—WÃ—3)</li>
<li>è¾“å‡ºï¼šç¨ å¯†æ·±åº¦å›¾D_dense âˆˆ R^(HÃ—W)</li>
<li>ç›®æ ‡ï¼šmin ||D_dense - D_gt||ï¼ŒåŒæ—¶ä¿æŒè¾¹ç¼˜å¯¹é½</li>
</ul>
<p><strong>ç¨€ç–æ·±åº¦å›¾ç”Ÿæˆï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_sparse_depth</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">img_height</span><span class="p">,</span> <span class="n">img_width</span><span class="p">):</span>
    <span class="n">depth_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">img_height</span><span class="p">,</span> <span class="n">img_width</span><span class="p">))</span>
    <span class="n">confidence_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">img_height</span><span class="p">,</span> <span class="n">img_width</span><span class="p">))</span>

    <span class="c1"># æŠ•å½±ç‚¹äº‘</span>
    <span class="n">P_cam</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">@</span> <span class="n">points</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">t</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">P_cam</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">P_cam</span> <span class="o">=</span> <span class="n">P_cam</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span>

    <span class="c1"># è®¡ç®—å›¾åƒåæ ‡</span>
    <span class="n">uv</span> <span class="o">=</span> <span class="n">K</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">@</span> <span class="n">P_cam</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">P_cam</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">K</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">uv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">uv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># å¤„ç†é‡å ï¼šZ-buffer</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)):</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">img_width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">img_height</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">depth_map</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">P_cam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">depth_map</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]]:</span>
                <span class="n">depth_map</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">P_cam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">confidence_map</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">P_cam</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>  <span class="c1"># åå°„å¼ºåº¦ä½œä¸ºç½®ä¿¡åº¦</span>

    <span class="k">return</span> <span class="n">depth_map</span><span class="p">,</span> <span class="n">confidence_map</span>
</code></pre></div>

<p><strong>ç»å…¸æ–¹æ³•ï¼š</strong></p>
<ol>
<li><strong>å›¾åƒå¼•å¯¼çš„å„å‘å¼‚æ€§æ‰©æ•£ï¼š</strong></li>
</ol>
<p>PDEå½¢å¼ï¼š</p>
<div class="codehilite"><pre><span></span><code>âˆ‚D/âˆ‚t = div(g(âˆ‡I)Â·âˆ‡D)
</code></pre></div>

<p>ç¦»æ•£åŒ–å®ç°ï¼š
   <code>D^(n+1) = D^n + Î»Â·[g_NÂ·(D_N-D) + g_SÂ·(D_S-D) + g_EÂ·(D_E-D) + g_WÂ·(D_W-D)]</code></p>
<p>å…¶ä¸­ä¼ å¯¼ç³»æ•°ï¼š
   <code>g_N = exp(-||I - I_N||Â²/kÂ²)
   g_S = exp(-||I - I_S||Â²/kÂ²)
   g_E = exp(-||I - I_E||Â²/kÂ²)
   g_W = exp(-||I - I_W||Â²/kÂ²)</code></p>
<p>å‚æ•°é€‰æ‹©ï¼š</p>
<ul>
<li>Î» = 0.25ï¼ˆç¨³å®šæ€§æ¡ä»¶ï¼‰</li>
<li>k = 0.1Ã—(I_max - I_min)ï¼ˆè¾¹ç¼˜é˜ˆå€¼ï¼‰</li>
<li>è¿­ä»£æ¬¡æ•°ï¼š100-500</li>
</ul>
<ol start="2">
<li><strong>åŒè¾¹æ»¤æ³¢æ·±åº¦è¡¥å…¨ï¼š</strong></li>
</ol>
<p>å®Œæ•´å…¬å¼ï¼š</p>
<div class="codehilite"><pre><span></span><code>D_dense(p) = Î£_{qâˆˆÎ©(p)} w_s(p,q)Â·w_r(I_p,I_q)Â·w_d(D_q)Â·D_sparse(q) / W
</code></pre></div>

<p>æƒé‡å‡½æ•°ï¼š</p>
<ul>
<li>ç©ºé—´æƒé‡ï¼šw_s(p,q) = exp(-||p-q||Â²/2Ïƒ_sÂ²)</li>
<li>é¢œè‰²æƒé‡ï¼šw_r(I_p,I_q) = exp(-||I_p-I_q||Â²/2Ïƒ_rÂ²)</li>
<li>æ·±åº¦ç½®ä¿¡åº¦ï¼šw_d(D_q) = exp(-|D_q|/Ïƒ_d) if D_q &gt; 0, else 0</li>
<li>å½’ä¸€åŒ–ï¼šW = Î£w_sÂ·w_rÂ·w_d</li>
</ul>
<p>å¤šå°ºåº¦ç­–ç•¥ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">multiscale_bilateral_filter</span><span class="p">(</span><span class="n">D_sparse</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">]):</span>
    <span class="n">D_result</span> <span class="o">=</span> <span class="n">D_sparse</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
        <span class="c1"># ä¸‹é‡‡æ ·</span>
        <span class="n">D_s</span> <span class="o">=</span> <span class="n">downsample</span><span class="p">(</span><span class="n">D_result</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">I_s</span> <span class="o">=</span> <span class="n">downsample</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

        <span class="c1"># åŒè¾¹æ»¤æ³¢</span>
        <span class="n">D_s</span> <span class="o">=</span> <span class="n">bilateral_filter</span><span class="p">(</span><span class="n">D_s</span><span class="p">,</span> <span class="n">I_s</span><span class="p">,</span> <span class="n">Ïƒ_s</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">scale</span><span class="p">,</span> <span class="n">Ïƒ_r</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="c1"># ä¸Šé‡‡æ ·å¹¶èåˆ</span>
        <span class="n">D_up</span> <span class="o">=</span> <span class="n">upsample</span><span class="p">(</span><span class="n">D_s</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">D_result</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">D_result</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_up</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">D_result</span>
</code></pre></div>

<ol start="3">
<li><strong>é©¬å°”å¯å¤«éšæœºåœºï¼ˆMRFï¼‰æ–¹æ³•ï¼š</strong></li>
</ol>
<p>èƒ½é‡å‡½æ•°ï¼š</p>
<div class="codehilite"><pre><span></span><code>E(D) = Î£_p Ï†_d(D_p) + Î»Â·Î£_{p,qâˆˆN} Ï†_s(D_p, D_q, I_p, I_q)
</code></pre></div>

<p>æ•°æ®é¡¹ï¼š
   <code>Ï†_d(D_p) = {
       (D_p - D_sparse(p))Â² if D_sparse(p) &gt; 0
       0                     otherwise
   }</code></p>
<p>å¹³æ»‘é¡¹ï¼š
   <code>Ï†_s(D_p, D_q, I_p, I_q) = min(|D_p - D_q|, Ï„_d) Ã— exp(-||I_p - I_q||/Ï„_i)</code></p>
<p><strong>æ·±åº¦å­¦ä¹ æ–¹æ³•ï¼š</strong></p>
<ol>
<li><strong>å·ç§¯ç¥ç»ç½‘ç»œæ¶æ„ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>è¾“å…¥ï¼š[D_sparse, I] âˆˆ R^(HÃ—WÃ—4)
ç¼–ç å™¨ï¼šResNetéª¨å¹²ç½‘ç»œæå–å¤šå°ºåº¦ç‰¹å¾
è§£ç å™¨ï¼šä¸Šé‡‡æ · + è·³è·ƒè¿æ¥
è¾“å‡ºï¼šD_dense âˆˆ R^(HÃ—WÃ—1)
</code></pre></div>

<ol start="2">
<li><strong>æŸå¤±å‡½æ•°è®¾è®¡ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>L_total = Î»_1Â·L_depth + Î»_2Â·L_smooth + Î»_3Â·L_normal

L_depth = ||D_pred - D_gt||_1
L_smooth = Î£|âˆ‡D_pred|Â·exp(-|âˆ‡I|)
L_normal = 1 - cos(n_pred, n_gt)
</code></pre></div>

<p><strong>å®é™…è®¡ç®—ç¤ºä¾‹ï¼š</strong></p>
<p>åœºæ™¯ï¼š5Ã—5çª—å£æ·±åº¦è¡¥å…¨</p>
<div class="codehilite"><pre><span></span><code>ç¨€ç–æ·±åº¦å›¾ï¼š        RGBå¼ºåº¦å›¾ï¼š
[0  0  0  0  0]    [120 125 130 135 140]
[0  10 0  0  0]    [115 120 125 130 135]
[0  0  ?  0  0]    [110 115 120 125 130]
[0  0  0  12 0]    [105 110 115 120 125]
[0  0  0  0  0]    [100 105 110 115 120]
</code></pre></div>

<p>è®¡ç®—ä¸­å¿ƒç‚¹(2,2)çš„æ·±åº¦ï¼š</p>
<ol>
<li>å·²çŸ¥æ·±åº¦ç‚¹ï¼š(1,1)=10m, (3,3)=12m</li>
<li>ç©ºé—´è·ç¦»ï¼šd_1 = âˆš2 â‰ˆ 1.41, d_2 = âˆš2 â‰ˆ 1.41</li>
<li>é¢œè‰²å·®å¼‚ï¼šÎ”I_1 = |120-120| = 0, Î”I_2 = |120-120| = 0</li>
<li>æƒé‡ï¼ˆÏƒ_s=2, Ïƒ_r=10ï¼‰ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>w_s1 = exp(-2/8) = 0.779
w_s2 = exp(-2/8) = 0.779
w_r1 = exp(0) = 1.0
w_r2 = exp(0) = 1.0
</code></pre></div>

<ol start="5">
<li>è¡¥å…¨ç»“æœï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>D(2,2) = (0.779Ã—10 + 0.779Ã—12)/(0.779+0.779) = 11m
</code></pre></div>

<p><strong>æ€§èƒ½è¯„ä¼°æŒ‡æ ‡ï¼š</strong></p>
<ul>
<li>MAEï¼šå¹³å‡ç»å¯¹è¯¯å·® = (1/N)Î£|D_pred - D_gt|</li>
<li>RMSEï¼šå‡æ–¹æ ¹è¯¯å·® = âˆš[(1/N)Î£(D_pred - D_gt)Â²]</li>
<li>Î´_tï¼šé˜ˆå€¼ç²¾åº¦ = % of pixels where max(D_pred/D_gt, D_gt/D_pred) &lt; t</li>
</ul>
<p><strong>ä¼˜åŒ–æŠ€å·§ï¼š</strong></p>
<ol>
<li>ç¨€ç–å·ç§¯ï¼šä»…åœ¨æœ‰æ•ˆæ·±åº¦ä½ç½®è®¡ç®—</li>
<li>ç½®ä¿¡åº¦ä¼ æ’­ï¼šä»é«˜ç½®ä¿¡åº¦åŒºåŸŸå‘å¤–æ‰©æ•£</li>
<li>è¾¹ç¼˜ä¿æŒï¼šä½¿ç”¨æ³•å‘é‡ä¸€è‡´æ€§çº¦æŸ</li>
</ol>
<h3 id="1115">11.1.5 èåˆæ¶æ„è®¾è®¡</h3>
<p>å¤šä¼ æ„Ÿå™¨èåˆæ¶æ„çš„é€‰æ‹©ç›´æ¥å½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œéœ€è¦åœ¨ç²¾åº¦ã€æ•ˆç‡å’Œå¯æ‰©å±•æ€§ä¹‹é—´æƒè¡¡ã€‚</p>
<p><strong>å‰èåˆï¼ˆEarly Fusionï¼‰ï¼š</strong></p>
<p>åœ¨åŸå§‹æ•°æ®å±‚é¢èåˆï¼Œä¿ç•™æœ€å¤šçš„åŸå§‹ä¿¡æ¯ï¼š</p>
<ol>
<li><strong>æ•°æ®çº§èåˆæ¶æ„ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>Raw LiDAR Points â”€â”€â”
                   â”œâ”€â†’ Joint Representation â†’ Processing â†’ Output
Raw Camera Image â”€â”€â”˜
</code></pre></div>

<ol start="2">
<li><strong>å®ç°æ–¹å¼ï¼š</strong></li>
</ol>
<p>a) <strong>å›¾åƒå¢å¼ºç‚¹äº‘ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># ä¸ºæ¯ä¸ª3Dç‚¹æ·»åŠ RGBå’Œçº¹ç†ç‰¹å¾</span>
<span class="n">enhanced_points</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">lidar_points</span><span class="p">:</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">project_to_image</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">valid_pixel</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="n">rgb</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">]</span>
        <span class="n">gradient</span> <span class="o">=</span> <span class="n">compute_gradient</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">point</span><span class="p">,</span> <span class="n">rgb</span><span class="p">,</span> <span class="n">gradient</span><span class="p">])</span>
        <span class="n">enhanced_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
</code></pre></div>

<p>b) <strong>æ·±åº¦å¢å¼ºå›¾åƒï¼š</strong>
   <code>python
   # ç”ŸæˆRGBDå›¾åƒ
   depth_map = project_lidar_to_depth(lidar_points, K, R, t)
   rgbd_image = np.dstack([rgb_image, depth_map])</code></p>
<ol start="3">
<li><strong>ä¼˜ç¼ºç‚¹åˆ†æï¼š</strong>
   - ä¼˜ç‚¹ï¼šä¿¡æ¯ä¿ç•™å®Œæ•´ï¼Œç†è®ºæ€§èƒ½ä¸Šé™é«˜
   - ç¼ºç‚¹ï¼šæ•°æ®ç»´åº¦é«˜ï¼Œè®¡ç®—å¤æ‚åº¦O(NÃ—M)
   - é€‚ç”¨åœºæ™¯ï¼šè®¡ç®—èµ„æºå……è¶³ï¼Œè¿½æ±‚æœ€é«˜ç²¾åº¦</li>
</ol>
<p><strong>åèåˆï¼ˆLate Fusionï¼‰ï¼š</strong></p>
<p>å„ä¼ æ„Ÿå™¨ç‹¬ç«‹å¤„ç†åèåˆç»“æœï¼š</p>
<ol>
<li><strong>å†³ç­–çº§èåˆæ¶æ„ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>LiDAR â†’ Detector_L â†’ Boxes_L â”€â”€â”
                               â”œâ”€â†’ Fusion â†’ Final Boxes
Camera â†’ Detector_C â†’ Boxes_C â”€â”˜
</code></pre></div>

<ol start="2">
<li><strong>èåˆç®—æ³•ï¼š</strong></li>
</ol>
<p>a) <strong>è´å¶æ–¯èåˆï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">bayesian_fusion</span><span class="p">(</span><span class="n">detections_lidar</span><span class="p">,</span> <span class="n">detections_camera</span><span class="p">):</span>
    <span class="c1"># è®¡ç®—è”åˆæ¦‚ç‡</span>
    <span class="n">P_joint</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">box_l</span> <span class="ow">in</span> <span class="n">detections_lidar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">box_c</span> <span class="ow">in</span> <span class="n">detections_camera</span><span class="p">:</span>
            <span class="n">iou</span> <span class="o">=</span> <span class="n">compute_iou</span><span class="p">(</span><span class="n">box_l</span><span class="p">,</span> <span class="n">box_c</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iou</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="c1"># P(object|L,C) = P(L|object)P(C|object)P(object) / P(L,C)</span>
                <span class="n">p_joint</span> <span class="o">=</span> <span class="n">box_l</span><span class="o">.</span><span class="n">conf</span> <span class="o">*</span> <span class="n">box_c</span><span class="o">.</span><span class="n">conf</span> <span class="o">*</span> <span class="n">prior</span><span class="p">[</span><span class="n">box_l</span><span class="o">.</span><span class="n">class</span><span class="p">]</span>
                <span class="n">P_joint</span><span class="p">[(</span><span class="n">box_l</span><span class="p">,</span> <span class="n">box_c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">p_joint</span>

    <span class="c1"># éæå¤§å€¼æŠ‘åˆ¶</span>
    <span class="k">return</span> <span class="n">nms</span><span class="p">(</span><span class="n">P_joint</span><span class="p">)</span>
</code></pre></div>

<p>b) <strong>åŒˆç‰™åˆ©åŒ¹é…ï¼š</strong>
   ```python
   # æ„å»ºä»£ä»·çŸ©é˜µ
   cost_matrix = np.zeros((len(det_l), len(det_c)))
   for i, box_l in enumerate(det_l):
       for j, box_c in enumerate(det_c):
           cost_matrix[i,j] = matching_cost(box_l, box_c)</p>
<p># æœ€ä¼˜åŒ¹é…
   row_ind, col_ind = linear_sum_assignment(cost_matrix)
   ```</p>
<ol start="3">
<li><strong>ç½®ä¿¡åº¦èåˆç­–ç•¥ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code>conf_fused = w_l Ã— conf_l + w_c Ã— conf_c + w_lc Ã— conf_l Ã— conf_c
</code></pre></div>

<p>å…¶ä¸­æƒé‡é€šè¿‡éªŒè¯é›†å­¦ä¹ ã€‚</p>
<p><strong>æ·±åº¦èåˆï¼ˆDeep Fusionï¼‰ï¼š</strong></p>
<p>åœ¨ç‰¹å¾å±‚é¢è¿›è¡Œèåˆï¼Œå…¼é¡¾æ•ˆç‡å’Œæ€§èƒ½ï¼š</p>
<ol>
<li><strong>å¤šçº§ç‰¹å¾èåˆæ¶æ„ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">DeepFusionNetwork</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_backbone</span> <span class="o">=</span> <span class="n">ResNet50</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lidar_backbone</span> <span class="o">=</span> <span class="n">PointNet</span><span class="o">++</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fusion_modules</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">([</span>
            <span class="n">FusionBlock</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span>  <span class="c1"># Early fusion</span>
            <span class="n">FusionBlock</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span>  <span class="c1"># Mid fusion</span>
            <span class="n">FusionBlock</span><span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span> <span class="c1"># Late fusion</span>
        <span class="p">])</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        <span class="c1"># æå–å¤šå°ºåº¦ç‰¹å¾</span>
        <span class="n">img_feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_backbone</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">pts_feats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lidar_backbone</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>

        <span class="c1"># å¤šçº§èåˆ</span>
        <span class="n">fused_feats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fusion</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fusion_modules</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">fusion</span><span class="p">(</span><span class="n">img_feats</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pts_feats</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">fused_feats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">fused_feats</span><span class="p">)</span>
</code></pre></div>

<ol start="2">
<li><strong>æ³¨æ„åŠ›èåˆæœºåˆ¶ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AttentionFusion</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_img</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_pts</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_pts</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_feat</span><span class="p">,</span> <span class="n">pts_feat</span><span class="p">):</span>
        <span class="c1"># Cross-attention</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_img</span><span class="p">(</span><span class="n">img_feat</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_pts</span><span class="p">(</span><span class="n">pts_feat</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_pts</span><span class="p">(</span><span class="n">pts_feat</span><span class="p">)</span>

        <span class="n">attn</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">Q</span> <span class="o">@</span> <span class="n">K</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="err">âˆš</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fused</span> <span class="o">=</span> <span class="n">attn</span> <span class="o">@</span> <span class="n">V</span>

        <span class="k">return</span> <span class="n">fused</span> <span class="o">+</span> <span class="n">img_feat</span>  <span class="c1"># Residual</span>
</code></pre></div>

<ol start="3">
<li><strong>è‡ªé€‚åº”èåˆæƒé‡ï¼š</strong></li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">AdaptiveFusion</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight_net</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">channels</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Softmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feat_img</span><span class="p">,</span> <span class="n">feat_pts</span><span class="p">):</span>
        <span class="n">concat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">feat_img</span><span class="p">,</span> <span class="n">feat_pts</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight_net</span><span class="p">(</span><span class="n">concat</span><span class="p">)</span>  <span class="c1"># [B, 2, H, W]</span>

        <span class="n">fused</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">feat_img</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">feat_pts</span>
        <span class="k">return</span> <span class="n">fused</span>
</code></pre></div>

<p><strong>æ··åˆèåˆæ¶æ„ï¼š</strong></p>
<p>ç»“åˆå¤šç§èåˆç­–ç•¥çš„ä¼˜åŠ¿ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">HybridFusion</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">early_fusion</span> <span class="o">=</span> <span class="n">PointPainting</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deep_fusion</span> <span class="o">=</span> <span class="n">DeepFusionNet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">late_fusion</span> <span class="o">=</span> <span class="n">DecisionFusion</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">lidar</span><span class="p">):</span>
        <span class="c1"># 1. æ—©æœŸèåˆå¢å¼ºè¾“å…¥</span>
        <span class="n">painted_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">early_fusion</span><span class="p">(</span><span class="n">lidar</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>

        <span class="c1"># 2. æ·±åº¦ç½‘ç»œå¤„ç†</span>
        <span class="n">detections_deep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deep_fusion</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">painted_points</span><span class="p">)</span>

        <span class="c1"># 3. ç‹¬ç«‹æ£€æµ‹å™¨</span>
        <span class="n">detections_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_detector</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">detections_pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pts_detector</span><span class="p">(</span><span class="n">lidar</span><span class="p">)</span>

        <span class="c1"># 4. åæœŸèåˆ</span>
        <span class="n">final_detections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">late_fusion</span><span class="p">([</span>
            <span class="n">detections_deep</span><span class="p">,</span>
            <span class="n">detections_img</span><span class="p">,</span>
            <span class="n">detections_pts</span>
        <span class="p">])</span>

        <span class="k">return</span> <span class="n">final_detections</span>
</code></pre></div>

<p><strong>æ€§èƒ½å¯¹æ¯”ï¼ˆKITTIæ•°æ®é›†ï¼‰ï¼š</strong></p>
<p>| èåˆç­–ç•¥ | Car AP@0.7 | Pedestrian AP@0.5 | Cyclist AP@0.5 | FPS |</p>
<table>
<thead>
<tr>
<th>èåˆç­–ç•¥</th>
<th>Car AP@0.7</th>
<th>Pedestrian AP@0.5</th>
<th>Cyclist AP@0.5</th>
<th>FPS</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä»…æ¿€å…‰é›·è¾¾</td>
<td>79.8%</td>
<td>52.1%</td>
<td>67.3%</td>
<td>20</td>
</tr>
<tr>
<td>ä»…ç›¸æœº</td>
<td>74.2%</td>
<td>45.6%</td>
<td>58.9%</td>
<td>30</td>
</tr>
<tr>
<td>å‰èåˆ</td>
<td>84.3%</td>
<td>58.2%</td>
<td>73.1%</td>
<td>8</td>
</tr>
<tr>
<td>åèåˆ</td>
<td>82.1%</td>
<td>55.7%</td>
<td>70.8%</td>
<td>15</td>
</tr>
<tr>
<td>æ·±åº¦èåˆ</td>
<td>85.6%</td>
<td>60.3%</td>
<td>74.9%</td>
<td>12</td>
</tr>
<tr>
<td>æ··åˆèåˆ</td>
<td>86.9%</td>
<td>61.8%</td>
<td>76.2%</td>
<td>10</td>
</tr>
</tbody>
</table>
<p><strong>å·¥ç¨‹å®è·µå»ºè®®ï¼š</strong></p>
<ol>
<li><strong>å®æ—¶ç³»ç»Ÿï¼ˆ&gt;10Hzï¼‰ï¼š</strong> ä¼˜å…ˆåèåˆï¼Œè®¡ç®—å¹¶è¡ŒåŒ–</li>
<li><strong>é«˜ç²¾åº¦éœ€æ±‚ï¼š</strong> æ·±åº¦èåˆæˆ–æ··åˆèåˆ</li>
<li><strong>ä¼ æ„Ÿå™¨å¼‚æ­¥ï¼š</strong> åèåˆï¼Œç‹¬ç«‹å¤„ç†æ—¶åº</li>
<li><strong>æ•…éšœå®¹é”™ï¼š</strong> åèåˆï¼Œä¾¿äºä¼ æ„Ÿå™¨åˆ‡æ¢</li>
<li><strong>è¾¹ç¼˜è®¡ç®—ï¼š</strong> è½»é‡çº§å‰èåˆæˆ–åèåˆ</li>
</ol>
<h2 id="112">11.2 æ¿€å…‰é›·è¾¾+æ¯«ç±³æ³¢é›·è¾¾èåˆ</h2>
<p>æ¯«ç±³æ³¢é›·è¾¾èƒ½å¤Ÿç›´æ¥æµ‹é‡ç›®æ ‡çš„å¾„å‘é€Ÿåº¦ï¼Œä¸”åœ¨æ¶åŠ£å¤©æ°”ä¸‹å·¥ä½œç¨³å®šï¼Œä¸æ¿€å…‰é›·è¾¾å½¢æˆè‰¯å¥½äº’è¡¥ã€‚</p>
<h3 id="1121">11.2.1 é€Ÿåº¦ä¿¡æ¯èåˆ</h3>
<p>æ¯«ç±³æ³¢é›·è¾¾é€šè¿‡å¤šæ™®å‹’æ•ˆåº”æµ‹é‡å¾„å‘é€Ÿåº¦ï¼š</p>
<div class="codehilite"><pre><span></span><code>f_d = 2v_r f_0/c
v_r = f_dÂ·c/(2f_0)
</code></pre></div>

<p>å…¶ä¸­f_0æ˜¯è½½æ³¢é¢‘ç‡ï¼ˆå¦‚77GHzï¼‰ï¼Œv_ræ˜¯å¾„å‘é€Ÿåº¦ã€‚</p>
<p><strong>å¡å°”æ›¼æ»¤æ³¢èåˆæ¡†æ¶ï¼š</strong></p>
<p>çŠ¶æ€å‘é‡ï¼šX = [x, y, z, vx, vy, vz]^T</p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š</p>
<div class="codehilite"><pre><span></span><code>X_k = FÂ·X_{k-1} + w
F = [Iâ‚ƒ  Î”tÂ·Iâ‚ƒ]
    [0â‚ƒ    Iâ‚ƒ ]
</code></pre></div>

<p>æ¿€å…‰é›·è¾¾è§‚æµ‹æ¨¡å‹ï¼ˆåªæœ‰ä½ç½®ï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>Z_lidar = H_lidarÂ·X + v_lidar
H_lidar = [Iâ‚ƒ 0â‚ƒ]
</code></pre></div>

<p>æ¯«ç±³æ³¢é›·è¾¾è§‚æµ‹æ¨¡å‹ï¼ˆä½ç½®+å¾„å‘é€Ÿåº¦ï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>Z_radar = h_radar(X) + v_radar
h_radar(X) = [x, y, z, (xÂ·vx + yÂ·vy + zÂ·vz)/âˆš(xÂ²+yÂ²+zÂ²)]^T
</code></pre></div>

<p><strong>èåˆæ›´æ–°æ­¥éª¤ï¼š</strong></p>
<ol>
<li>é¢„æµ‹ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>XÌ‚_k|k-1 = FÂ·XÌ‚_{k-1}
P_k|k-1 = FÂ·P_{k-1}Â·F^T + Q
</code></pre></div>

<ol start="2">
<li>æ¿€å…‰é›·è¾¾æ›´æ–°ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>K_lidar = P_k|k-1Â·H_lidar^TÂ·(H_lidarÂ·P_k|k-1Â·H_lidar^T + R_lidar)^{-1}
XÌ‚_k = XÌ‚_k|k-1 + K_lidarÂ·(Z_lidar - H_lidarÂ·XÌ‚_k|k-1)
</code></pre></div>

<ol start="3">
<li>æ¯«ç±³æ³¢é›·è¾¾æ›´æ–°ï¼ˆä½¿ç”¨EKFï¼‰ï¼š</li>
</ol>
<div class="codehilite"><pre><span></span><code>H_radar = âˆ‚h_radar/âˆ‚X|_{XÌ‚_k}
K_radar = P_kÂ·H_radar^TÂ·(H_radarÂ·P_kÂ·H_radar^T + R_radar)^{-1}
XÌ‚_k = XÌ‚_k + K_radarÂ·(Z_radar - h_radar(XÌ‚_k))
</code></pre></div>

<p><strong>è®¡ç®—å®ä¾‹ï¼š</strong>
ç›®æ ‡åœ¨(10, 5, 0)mï¼Œé€Ÿåº¦(2, -1, 0)m/sï¼š</p>
<ul>
<li>æ¿€å…‰é›·è¾¾æµ‹é‡ï¼š(10.1, 4.9, 0.05)m</li>
<li>æ¯«ç±³æ³¢é›·è¾¾æµ‹é‡ï¼šå¾„å‘é€Ÿåº¦ v_r = (10Ã—2 + 5Ã—(-1))/âˆš125 = 1.34m/s</li>
</ul>
<p>å¾„å‘é€Ÿåº¦éªŒè¯ï¼š</p>
<div class="codehilite"><pre><span></span><code>v_r_true = (xÂ·vx + yÂ·vy)/r = (10Ã—2 + 5Ã—(-1))/11.18 = 1.34m/s âœ“
</code></pre></div>

<h3 id="1122">11.2.2 æ£€æµ‹ç½®ä¿¡åº¦èåˆ</h3>
<p>ä¸åŒä¼ æ„Ÿå™¨å¯¹ä¸åŒç›®æ ‡çš„æ£€æµ‹èƒ½åŠ›ä¸åŒï¼Œéœ€è¦èåˆç½®ä¿¡åº¦ï¼š</p>
<p><strong>D-Sè¯æ®ç†è®ºèåˆï¼š</strong>
åŸºæœ¬æ¦‚ç‡åˆ†é…ï¼ˆBPAï¼‰ï¼š</p>
<ul>
<li>mâ‚(A)ï¼šæ¿€å…‰é›·è¾¾è®¤ä¸ºæ˜¯è½¦è¾†çš„æ¦‚ç‡</li>
<li>mâ‚‚(A)ï¼šæ¯«ç±³æ³¢é›·è¾¾è®¤ä¸ºæ˜¯è½¦è¾†çš„æ¦‚ç‡</li>
</ul>
<p>ç»„åˆè§„åˆ™ï¼š</p>
<div class="codehilite"><pre><span></span><code>m(A) = Î£_{Bâˆ©C=A} mâ‚(B)Â·mâ‚‚(C) / (1-K)
K = Î£_{Bâˆ©C=âˆ…} mâ‚(B)Â·mâ‚‚(C)
</code></pre></div>

<p><strong>ç¤ºä¾‹è®¡ç®—ï¼š</strong>
å¯¹äºæŸç›®æ ‡ï¼š</p>
<ul>
<li>æ¿€å…‰é›·è¾¾ï¼šmâ‚(è½¦)=0.7, mâ‚(äºº)=0.2, mâ‚(ä¸ç¡®å®š)=0.1</li>
<li>æ¯«ç±³æ³¢ï¼šmâ‚‚(è½¦)=0.8, mâ‚‚(äºº)=0.1, mâ‚‚(ä¸ç¡®å®š)=0.1</li>
</ul>
<p>èåˆç»“æœï¼š</p>
<div class="codehilite"><pre><span></span><code>K = mâ‚(è½¦)Â·mâ‚‚(äºº) + mâ‚(äºº)Â·mâ‚‚(è½¦) = 0.7Ã—0.1 + 0.2Ã—0.8 = 0.23
m(è½¦) = (0.7Ã—0.8 + 0.7Ã—0.1 + 0.1Ã—0.8)/(1-0.23) = 0.71/0.77 = 0.922
m(äºº) = (0.2Ã—0.1 + 0.2Ã—0.1 + 0.1Ã—0.1)/(1-0.23) = 0.05/0.77 = 0.065
</code></pre></div>

<h3 id="1123">11.2.3 æ¶åŠ£å¤©æ°”äº’è¡¥</h3>
<p><strong>é›¨é›¾è¡°å‡æ¨¡å‹ï¼š</strong></p>
<p>æ¿€å…‰é›·è¾¾è¡°å‡ï¼ˆ905nmï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>Î±_lidar_rain â‰ˆ 0.2Ã—R^0.6 dB/km (R: mm/h)
Î±_lidar_fog â‰ˆ 13Ã—V^{-0.6} dB/km (V: èƒ½è§åº¦m)
</code></pre></div>

<p>æ¯«ç±³æ³¢é›·è¾¾è¡°å‡ï¼ˆ77GHzï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>Î±_radar_rain â‰ˆ 0.003Ã—R^1.2 dB/km
Î±_radar_fog â‰ˆ 0.4 dB/km (è½»é›¾)
</code></pre></div>

<p><strong>äº’è¡¥ç­–ç•¥ï¼š</strong></p>
<ol>
<li>æ™´å¤©ï¼šæ¿€å…‰é›·è¾¾æƒé‡0.8ï¼Œæ¯«ç±³æ³¢0.2</li>
<li>å°é›¨ï¼ˆ5mm/hï¼‰ï¼šæ¿€å…‰é›·è¾¾æƒé‡0.6ï¼Œæ¯«ç±³æ³¢0.4</li>
<li>å¤§é›¨ï¼ˆ50mm/hï¼‰ï¼šæ¿€å…‰é›·è¾¾æƒé‡0.3ï¼Œæ¯«ç±³æ³¢0.7</li>
<li>æµ“é›¾ï¼ˆV&lt;50mï¼‰ï¼šæ¿€å…‰é›·è¾¾æƒé‡0.1ï¼Œæ¯«ç±³æ³¢0.9</li>
</ol>
<p><strong>è‡ªé€‚åº”æƒé‡è®¡ç®—ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>w_lidar = exp(-Î±_lidarÃ—R) / (exp(-Î±_lidarÃ—R) + exp(-Î±_radarÃ—R))
w_radar = 1 - w_lidar
</code></pre></div>

<h3 id="1124">11.2.4 æ•°æ®å…³è”ç®—æ³•</h3>
<p>æ¿€å…‰é›·è¾¾å’Œæ¯«ç±³æ³¢é›·è¾¾çš„æ£€æµ‹éœ€è¦æ­£ç¡®å…³è”ï¼š</p>
<p><strong>æœ€è¿‘é‚»å…³è”ï¼š</strong>
é©¬æ°è·ç¦»ï¼š</p>
<div class="codehilite"><pre><span></span><code>dÂ²_ij = (z_i - áº‘_j)^TÂ·S^{-1}Â·(z_i - áº‘_j)
</code></pre></div>

<p>å…¶ä¸­Sæ˜¯æ–°æ¯åæ–¹å·®çŸ©é˜µã€‚</p>
<p><strong>é—¨é™åˆ¤æ–­ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>dÂ²_ij &lt; Ï‡Â²_Î±(n)
</code></pre></div>

<p>å¯¹äº3ç»´ä½ç½®ï¼Œ95%ç½®ä¿¡åº¦ï¼šÏ‡Â²_{0.05}(3) = 7.815</p>
<p><strong>å…¨å±€æœ€ä¼˜å…³è”ï¼ˆåŒˆç‰™åˆ©ç®—æ³•ï¼‰ï¼š</strong>
æ„å»ºä»£ä»·çŸ©é˜µCï¼Œå…¶ä¸­C_ij = dÂ²_ijï¼Œæ±‚è§£ï¼š</p>
<div class="codehilite"><pre><span></span><code>min Î£_i Î£_j C_ijÂ·x_ij
s.t. Î£_i x_ij = 1, Î£_j x_ij = 1, x_ij âˆˆ {0,1}
</code></pre></div>

<h2 id="113-imu">11.3 æ¿€å…‰é›·è¾¾+IMUèåˆ</h2>
<p>IMUï¼ˆæƒ¯æ€§æµ‹é‡å•å…ƒï¼‰æä¾›é«˜é¢‘ç‡çš„åŠ é€Ÿåº¦å’Œè§’é€Ÿåº¦æµ‹é‡ï¼Œå¯ä»¥æœ‰æ•ˆè¡¥å¿æ¿€å…‰é›·è¾¾çš„è¿åŠ¨ç•¸å˜ï¼Œæé«˜SLAMç²¾åº¦ã€‚</p>
<h3 id="1131-slam">11.3.1 ç´§è€¦åˆSLAMæ¡†æ¶</h3>
<p><strong>è¯¯å·®çŠ¶æ€å¡å°”æ›¼æ»¤æ³¢ï¼ˆESKFï¼‰ï¼š</strong></p>
<p>çŠ¶æ€å‘é‡ï¼ˆ15ç»´ï¼‰ï¼š</p>
<div class="codehilite"><pre><span></span><code>X = [Î´p, Î´v, Î´Î¸, Î´b_a, Î´b_g]^T
</code></pre></div>

<ul>
<li>Î´pï¼šä½ç½®è¯¯å·®</li>
<li>Î´vï¼šé€Ÿåº¦è¯¯å·®  </li>
<li>Î´Î¸ï¼šå§¿æ€è¯¯å·®ï¼ˆSO(3)æä»£æ•°ï¼‰</li>
<li>Î´b_aï¼šåŠ é€Ÿåº¦è®¡åç½®è¯¯å·®</li>
<li>Î´b_gï¼šé™€èºä»ªåç½®è¯¯å·®</li>
</ul>
<p><strong>è¿ç»­æ—¶é—´è¿åŠ¨æ–¹ç¨‹ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>á¹— = v
vÌ‡ = R(a - b_a - n_a) - g
á¹˜ = RÂ·[Ï‰ - b_g - n_g]Ã—
á¸ƒ_a = n_ba
á¸ƒ_g = n_bg
</code></pre></div>

<p><strong>è¯¯å·®çŠ¶æ€ä¼ æ’­ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">Î´áº‹</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="err">Â·</span><span class="n">Î´x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">G</span><span class="err">Â·</span><span class="n">n</span>

<span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">0   I   0     0      0   </span><span class="o">]</span>
<span class="w">    </span><span class="o">[</span><span class="n">0   0  -R[a</span><span class="o">]</span><span class="err">Ã—</span><span class="w"> </span><span class="o">-</span><span class="n">R</span><span class="w">     </span><span class="mi">0</span><span class="w">   </span><span class="err">]</span>
<span class="w">    </span><span class="o">[</span><span class="n">0   0  -[Ï‰</span><span class="o">]</span><span class="err">Ã—</span><span class="w">  </span><span class="mi">0</span><span class="w">     </span><span class="o">-</span><span class="n">I</span><span class="w">   </span><span class="err">]</span>
<span class="w">    </span><span class="o">[</span><span class="n">0   0   0     0      0   </span><span class="o">]</span>
<span class="w">    </span><span class="o">[</span><span class="n">0   0   0     0      0   </span><span class="o">]</span>
</code></pre></div>

<p>å…¶ä¸­[a]Ã—è¡¨ç¤ºåå¯¹ç§°çŸ©é˜µï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="k">[a]Ã— = [ 0   -a_z  a_y]</span>
<span class="w">       </span><span class="k">[ a_z  0   -a_x]</span>
<span class="w">       </span><span class="k">[-a_y  a_x  0  ]</span>
</code></pre></div>

<p><strong>ç¦»æ•£åŒ–ï¼ˆä¸­å€¼ç§¯åˆ†ï¼‰ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>Î´x_k = (I + FÂ·Î”t)Â·Î´x_{k-1} + GÂ·nÂ·âˆšÎ”t
P_k = Î¦Â·P_{k-1}Â·Î¦^T + Q_d
</code></pre></div>

<h3 id="1132-imu">11.3.2 IMUé¢„ç§¯åˆ†ç†è®º</h3>
<p>é¢„ç§¯åˆ†é¿å…äº†æ¯æ¬¡ä¼˜åŒ–æ—¶é‡æ–°ç§¯åˆ†IMUæ•°æ®ï¼š</p>
<p><strong>ä½ç½®é¢„ç§¯åˆ†ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>Î”p_{ij} = âˆ«_i^j âˆ«_i^t R_s(a_s - b_a)dsdt - (t_j-t_i)Â²g/2
</code></pre></div>

<p><strong>é€Ÿåº¦é¢„ç§¯åˆ†ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>Î”v_{ij} = âˆ«_i^j R_t(a_t - b_a)dt - (t_j-t_i)g
</code></pre></div>

<p><strong>æ—‹è½¬é¢„ç§¯åˆ†ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>Î”R_{ij} = âˆ_{k=i}^{j-1} Exp((Ï‰_k - b_g)Î”t)
</code></pre></div>

<p>å…¶ä¸­Expæ˜¯SO(3)æŒ‡æ•°æ˜ å°„ï¼š</p>
<div class="codehilite"><pre><span></span><code>Exp(Ï‰) = I + sin(||Ï‰||)/||Ï‰||Â·[Ï‰]Ã— + (1-cos(||Ï‰||))/||Ï‰||Â²Â·[Ï‰]Ã—Â²
</code></pre></div>

<p><strong>é¢„ç§¯åˆ†æµ‹é‡çš„é›…å¯æ¯”ï¼š</strong>
å¯¹äºåç½®å˜åŒ–çš„ä¸€é˜¶è¿‘ä¼¼ï¼š</p>
<div class="codehilite"><pre><span></span><code>Î”pÌƒ_{ij} â‰ˆ Î”p_{ij} + J_p^{ba}Â·Î´b_a + J_p^{bg}Â·Î´b_g
Î”á¹½_{ij} â‰ˆ Î”v_{ij} + J_v^{ba}Â·Î´b_a + J_v^{bg}Â·Î´b_g
Î”RÌƒ_{ij} â‰ˆ Î”R_{ij}Â·Exp(J_R^{bg}Â·Î´b_g)
</code></pre></div>

<p><strong>è®¡ç®—å®ä¾‹ï¼š</strong>
ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´ï¼ŒIMUé‡‡æ ·100Hzï¼ŒæŒç»­0.5ç§’ï¼š</p>
<ul>
<li>å¹³å‡åŠ é€Ÿåº¦ï¼ša = [0.1, 0, 9.85] m/sÂ²ï¼ˆåŒ…å«é‡åŠ›ï¼‰</li>
<li>å¹³å‡è§’é€Ÿåº¦ï¼šÏ‰ = [0, 0, 0.1] rad/s</li>
<li>åç½®ï¼šb_a = [0.01, 0.01, 0], b_g = [0.001, 0.001, 0.002]</li>
</ul>
<p>é¢„ç§¯åˆ†ç»“æœï¼š</p>
<div class="codehilite"><pre><span></span><code>Î”v = âˆ«(a - b_a)dt - tg = [0.045, -0.005, 0.125] m/s
Î”p = âˆ«âˆ«(a - b_a)dtdt - tÂ²g/2 = [0.011, -0.001, 0.031] m
Î”R = Exp((Ï‰ - b_g)t) â‰ˆ Exp([0, 0, 0.049])
</code></pre></div>

<h3 id="1133">11.3.3 è¿åŠ¨ç•¸å˜æ ¡æ­£</h3>
<p>æ¿€å…‰é›·è¾¾æ‰«ææœŸé—´çš„è¿åŠ¨å¯¼è‡´ç‚¹äº‘ç•¸å˜ï¼š</p>
<p><strong>çº¿æ€§æ’å€¼æ–¹æ³•ï¼š</strong>
å¯¹äºæ—¶åˆ»t_içš„ç‚¹P_iï¼Œæ ¡æ­£åˆ°å‚è€ƒæ—¶åˆ»t_0ï¼š</p>
<div class="codehilite"><pre><span></span><code>P_0 = R_{0i}^{-1}(P_i - t_{0i})
</code></pre></div>

<p>å…¶ä¸­R_{0i}å’Œt_{0i}é€šè¿‡IMUç§¯åˆ†è·å¾—ï¼š</p>
<div class="codehilite"><pre><span></span><code>R_{0i} = R_0Â·âˆ_{k=0}^{i-1} Exp(Ï‰_kÂ·Î”t)
t_{0i} = Î£_{k=0}^{i-1} v_kÂ·Î”t + 0.5Â·a_kÂ·Î”tÂ²
</code></pre></div>

<p><strong>å»ç•¸å˜ç®—æ³•æµç¨‹ï¼š</strong></p>
<ol>
<li>å¯¹æ¯ä¸ªæ¿€å…‰ç‚¹ï¼Œè®°å½•å…¶æ—¶é—´æˆ³t_i</li>
<li>ä»IMUè·å–[t_0, t_i]æœŸé—´çš„æµ‹é‡</li>
<li>ç§¯åˆ†å¾—åˆ°ç›¸å¯¹ä½å§¿å˜æ¢</li>
<li>å°†ç‚¹å˜æ¢åˆ°ç»Ÿä¸€åæ ‡ç³»</li>
</ol>
<p><strong>å®é™…æ¡ˆä¾‹ï¼š</strong>
è½¦è¾†ä»¥20m/sè¡Œé©¶ï¼Œæ¿€å…‰é›·è¾¾10Hzæ—‹è½¬ï¼š</p>
<ul>
<li>ä¸€åœˆæ‰«ææ—¶é—´ï¼š100ms</li>
<li>ä½ç§»ï¼š20Ã—0.1 = 2m</li>
<li>ä¸æ ¡æ­£è¯¯å·®ï¼šæœ€å¤§2m</li>
</ul>
<p>ä½¿ç”¨IMUï¼ˆ200Hzï¼‰æ ¡æ­£ï¼š</p>
<ul>
<li>æ¯5msæ›´æ–°ä¸€æ¬¡ä½å§¿</li>
<li>æœ€å¤§è¯¯å·®é™è‡³ï¼š20Ã—0.005 = 0.1m</li>
</ul>
<h3 id="1134">11.3.4 çŠ¶æ€ä¼°è®¡ä¼˜åŒ–</h3>
<p><strong>å›¾ä¼˜åŒ–æ¡†æ¶ï¼š</strong>
æ„å»ºå› å­å›¾ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>IMUå› å­ï¼šåŸºäºé¢„ç§¯åˆ†</li>
<li>æ¿€å…‰é›·è¾¾å› å­ï¼šç‚¹åˆ°é¢è·ç¦»</li>
<li>å›ç¯å› å­ï¼šä½å§¿çº¦æŸ</li>
</ul>
<p><strong>ä»£ä»·å‡½æ•°ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>min Î£||r_IMU||Â²_{Î£_IMU} + Î£||r_LiDAR||Â²_{Î£_LiDAR} + Î£||r_loop||Â²_{Î£_loop}
</code></pre></div>

<p><strong>IMUæ®‹å·®ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>r_IMU = [R_i^T(p_j - p_i - v_iÂ·Î”t - gÂ·Î”tÂ²/2) - Î”p_{ij}]
        [R_i^T(v_j - v_i - gÂ·Î”t) - Î”v_{ij}        ]
        [Log(Î”R_{ij}^TÂ·R_i^TÂ·R_j)                 ]
</code></pre></div>

<p><strong>LiDARæ®‹å·®ï¼ˆç‚¹åˆ°é¢ï¼‰ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>r_LiDAR = n^TÂ·(RÂ·p + t - q)
</code></pre></div>

<p>å…¶ä¸­næ˜¯å¹³é¢æ³•å‘é‡ï¼Œqæ˜¯å¹³é¢ä¸Šçš„ç‚¹ã€‚</p>
<p><strong>ä¼˜åŒ–æ±‚è§£ï¼š</strong>
ä½¿ç”¨Levenberg-Marquardtç®—æ³•ï¼š</p>
<div class="codehilite"><pre><span></span><code>(J^TÂ·WÂ·J + Î»I)Â·Î”x = -J^TÂ·WÂ·r
</code></pre></div>

<h3 id="1135">11.3.5 ä¼ æ„Ÿå™¨æ ‡å®š</h3>
<p><strong>IMU-LiDARå¤–å‚æ ‡å®šï¼š</strong>
æ—‹è½¬å¤–å‚R_ILï¼Œå¹³ç§»å¤–å‚t_IL</p>
<p>æ ‡å®šä¼˜åŒ–é—®é¢˜ï¼š</p>
<div class="codehilite"><pre><span></span><code>min Î£||p_L^j - R_ILÂ·R_IBÂ·(p_L^i - t_IL) - t_IL - R_ILÂ·t_IB||Â²
</code></pre></div>

<p><strong>æ—¶é—´åç§»æ ‡å®šï¼š</strong>
IMUå’ŒLiDARå¯èƒ½å­˜åœ¨æ—¶é—´åç§»t_dï¼š</p>
<div class="codehilite"><pre><span></span><code>t_IMU = t_LiDAR + t_d
</code></pre></div>

<p>é€šè¿‡æœ€å¤§åŒ–è§’é€Ÿåº¦ç›¸å…³æ€§ä¼°è®¡ï¼š</p>
<div class="codehilite"><pre><span></span><code>t_d = argmax Corr(Ï‰_IMU(t), Ï‰_LiDAR(t-Ï„))
</code></pre></div>

<h2 id="114-gpsrtk">11.4 æ¿€å…‰é›·è¾¾+GPS/RTKèåˆ</h2>
<p>GPS/RTKæä¾›å…¨å±€å®šä½ä¿¡æ¯ï¼Œå¯ä»¥æ¶ˆé™¤SLAMçš„ç´¯ç§¯è¯¯å·®ï¼Œå®ç°å¤§èŒƒå›´é«˜ç²¾åº¦å®šä½ã€‚</p>
<h3 id="1141">11.4.1 å…¨å±€å®šä½èåˆæ¡†æ¶</h3>
<p><strong>å›¾ä¼˜åŒ–æ¨¡å‹ï¼š</strong>
èŠ‚ç‚¹ï¼šæœºå™¨äººä½å§¿X_i = [x, y, z, roll, pitch, yaw]^T
è¾¹ï¼š</p>
<ul>
<li>é‡Œç¨‹è®¡è¾¹ï¼šç›¸é‚»å¸§é—´çš„ç›¸å¯¹ä½å§¿</li>
<li>GPSè¾¹ï¼šç»å¯¹ä½ç½®çº¦æŸ</li>
<li>å›ç¯è¾¹ï¼šé—­ç¯æ£€æµ‹çº¦æŸ</li>
</ul>
<p><strong>ä»£ä»·å‡½æ•°ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>E = Î£||X_j âŠ– X_i âŠ– Z_{ij}^{odom}||Â²_{Î£_{ij}} 

  + Î£||p_i - Z_i^{GPS}||Â²_{Î£_{GPS}}
  + Î£||X_j âŠ– X_i âŠ– Z_{ij}^{loop}||Â²_{Î£_{loop}}
</code></pre></div>

<p>å…¶ä¸­âŠ–è¡¨ç¤ºSE(3)ä¸Šçš„è¯¯å·®è¿ç®—ã€‚</p>
<p><strong>GPSæµ‹é‡æ¨¡å‹ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>Z_GPS = p_true + R_ENUÂ·[Ïƒ_NÂ·n_N, Ïƒ_EÂ·n_E, Ïƒ_UÂ·n_U]^T
</code></pre></div>

<ul>
<li>Ïƒ_N, Ïƒ_E, Ïƒ_Uï¼šåŒ—ä¸œå¤©æ–¹å‘çš„æ ‡å‡†å·®</li>
<li>RTKå®šä½ï¼šÏƒ_N = Ïƒ_E â‰ˆ 0.01m, Ïƒ_U â‰ˆ 0.02m</li>
<li>æ™®é€šGPSï¼šÏƒ_N = Ïƒ_E â‰ˆ 2-5m, Ïƒ_U â‰ˆ 5-10m</li>
</ul>
<p><strong>ENUåæ ‡è½¬æ¢ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code><span class="k">[E]   [-sin(lon)          cos(lon)           0    ] [X_ECEF]</span>
<span class="k">[N] = [-sin(lat)cos(lon) -sin(lat)sin(lon)  cos(lat)] [Y_ECEF]</span>
<span class="k">[U]   [cos(lat)cos(lon)   cos(lat)sin(lon)  sin(lat)] [Z_ECEF]</span>
</code></pre></div>

<h3 id="1142">11.4.2 å¤šè·¯å¾„æ•ˆåº”å¤„ç†</h3>
<p>åŸå¸‚ç¯å¢ƒä¸­çš„GPSä¿¡å·å—å»ºç­‘ç‰©åå°„å½±å“ï¼š</p>
<p><strong>å¤šè·¯å¾„æ£€æµ‹æŒ‡æ ‡ï¼š</strong></p>
<ol>
<li>C/Nâ‚€ï¼ˆè½½å™ªæ¯”ï¼‰ï¼š&lt; 35 dB-Hzè¡¨ç¤ºä¿¡å·å¼±</li>
<li>ä»°è§’ï¼š&lt; 15Â°çš„å«æ˜Ÿæ˜“å—å¤šè·¯å¾„å½±å“</li>
<li>DOPå€¼ï¼šPDOP &gt; 4è¡¨ç¤ºå‡ ä½•æ„å‹å·®</li>
</ol>
<p><strong>é²æ£’ä¼°è®¡æ–¹æ³•ï¼š</strong>
ä½¿ç”¨HuberæŸå¤±å‡½æ•°ï¼š</p>
<div class="codehilite"><pre><span></span><code>Ï(e) = {
    0.5Â·eÂ²,           |e| â‰¤ Î´
    Î´(|e| - 0.5Î´),   |e| &gt; Î´
}
</code></pre></div>

<p>æƒé‡å‡½æ•°ï¼š</p>
<div class="codehilite"><pre><span></span><code>w(e) = {
    1,        |e| â‰¤ Î´
    Î´/|e|,    |e| &gt; Î´
}
</code></pre></div>

<p><strong>ç¤ºä¾‹è®¡ç®—ï¼š</strong>
GPSæµ‹é‡å€¼ä¸é¢„æµ‹å€¼åå·®e = 5mï¼Œé˜ˆå€¼Î´ = 2mï¼š</p>
<ul>
<li>äºŒæ¬¡æŸå¤±ï¼šL = 0.5Ã—5Â² = 12.5</li>
<li>HuberæŸå¤±ï¼šL = 2Ã—(5-0.5Ã—2) = 8</li>
<li>æƒé‡ï¼šw = 2/5 = 0.4</li>
</ul>
<h3 id="1143">11.4.3 åŸå¸‚å³¡è°·é—®é¢˜</h3>
<p>é«˜æ¥¼ç¯å¢ƒå¯¼è‡´GPSä¿¡å·é®æŒ¡å’Œåå°„ï¼š</p>
<p><strong>å¯è§æ€§é¢„æµ‹ï¼š</strong>
ä½¿ç”¨æ¿€å…‰é›·è¾¾æ„å»ºçš„3Dåœ°å›¾é¢„æµ‹å«æ˜Ÿå¯è§æ€§ï¼š</p>
<div class="codehilite"><pre><span></span><code>Visible(sat_i) = RayCast(p_receiver, p_satellite) == clear
</code></pre></div>

<p><strong>å¤©ç©ºè§†é‡å› å­ï¼ˆSVFï¼‰ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>SVF = Î£_visible cos(Î¸_elevation) / Î£_all cos(Î¸_elevation)
</code></pre></div>

<p><strong>èåˆç­–ç•¥ï¼š</strong></p>
<ol>
<li>SVF &gt; 0.7ï¼šæ­£å¸¸èåˆGPS</li>
<li>0.3 &lt; SVF &lt; 0.7ï¼šé™ä½GPSæƒé‡</li>
<li>SVF &lt; 0.3ï¼šä»…ä¾èµ–æ¿€å…‰é›·è¾¾SLAM</li>
</ol>
<p><strong>è‡ªé€‚åº”åæ–¹å·®è°ƒæ•´ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>Î£_GPS_adjusted = Î£_GPS_base Ã— (2 - SVF)Â²
</code></pre></div>

<h3 id="1144-vs">11.4.4 æ¾è€¦åˆvsç´§è€¦åˆ</h3>
<p><strong>æ¾è€¦åˆæ¶æ„ï¼š</strong></p>
<ul>
<li>GPS/RTKç‹¬ç«‹è§£ç®—ä½ç½®</li>
<li>ä½œä¸ºä½ç½®çº¦æŸåŠ å…¥SLAM</li>
<li>ä¼˜ç‚¹ï¼šæ¨¡å—åŒ–ï¼Œè®¡ç®—ç®€å•</li>
<li>ç¼ºç‚¹ï¼šæœªå……åˆ†åˆ©ç”¨åŸå§‹è§‚æµ‹</li>
</ul>
<p><strong>ç´§è€¦åˆæ¶æ„ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨GPSåŸå§‹ä¼ªè·/è½½æ³¢ç›¸ä½è§‚æµ‹</li>
<li>ä¸æ¿€å…‰é›·è¾¾è”åˆä¼˜åŒ–</li>
<li>ä¼˜ç‚¹ï¼šç²¾åº¦é«˜ï¼Œé²æ£’æ€§å¥½</li>
<li>ç¼ºç‚¹ï¼šè®¡ç®—å¤æ‚</li>
</ul>
<p><strong>ä¼ªè·è§‚æµ‹æ–¹ç¨‹ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>Ï = ||p_sat - p_rec|| + c(dt_rec - dt_sat) + I + T + Îµ
</code></pre></div>

<ul>
<li>Iï¼šç”µç¦»å±‚å»¶è¿Ÿ</li>
<li>Tï¼šå¯¹æµå±‚å»¶è¿Ÿ</li>
<li>Îµï¼šå¤šè·¯å¾„å’Œå™ªå£°</li>
</ul>
<h3 id="1145">11.4.5 åˆå§‹åŒ–ä¸æ”¶æ•›</h3>
<p><strong>å…¨å±€åˆå§‹åŒ–ï¼š</strong></p>
<ol>
<li>ç­‰å¾…GPSé”å®šï¼ˆè‡³å°‘4é¢—å«æ˜Ÿï¼‰</li>
<li>é™æ­¢30ç§’æ”¶é›†IMUæ•°æ®ä¼°è®¡åˆå§‹å§¿æ€</li>
<li>ä½¿ç”¨GPSä½ç½®å’ŒIMUå§¿æ€åˆå§‹åŒ–</li>
</ol>
<p><strong>å±€éƒ¨åˆ°å…¨å±€åæ ‡è½¬æ¢ï¼š</strong>
æ¿€å…‰é›·è¾¾SLAMé€šå¸¸åœ¨å±€éƒ¨åæ ‡ç³»å·¥ä½œï¼Œéœ€è¦ä¼°è®¡åˆ°å…¨å±€åæ ‡ç³»çš„å˜æ¢ï¼š</p>
<div class="codehilite"><pre><span></span><code>T_global_local = argmin Î£||TÂ·p_i^local - p_i^GPS||Â²
</code></pre></div>

<p>ä½¿ç”¨SVDæ±‚è§£ï¼š</p>
<ol>
<li>è®¡ç®—è´¨å¿ƒï¼špÌ„_local, pÌ„_GPS</li>
<li>å»è´¨å¿ƒï¼šp'_i = p_i - pÌ„</li>
<li>è®¡ç®—H = Î£p'_localÂ·p'_GPS^T</li>
<li>SVDåˆ†è§£ï¼šH = UÎ£V^T</li>
<li>æ—‹è½¬ï¼šR = VU^T</li>
<li>å¹³ç§»ï¼št = pÌ„_GPS - RÂ·pÌ„_local</li>
</ol>
<p><strong>æ”¶æ•›ç›‘æµ‹ï¼š</strong></p>
<div class="codehilite"><pre><span></span><code>converged = (||Î”position|| &lt; 0.1m) &amp;&amp; (||Î”orientation|| &lt; 1Â°)
</code></pre></div>

<h2 id="_1">æœ¬ç« å°ç»“</h2>
<p>æœ¬ç« è¯¦ç»†ä»‹ç»äº†æ¿€å…‰é›·è¾¾ä¸ç›¸æœºã€æ¯«ç±³æ³¢é›·è¾¾ã€IMUå’ŒGPS/RTKçš„èåˆç®—æ³•ã€‚ä¸»è¦çŸ¥è¯†ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p><strong>æ¿€å…‰é›·è¾¾+ç›¸æœºèåˆ</strong>ï¼š
   - æŠ•å½±çŸ©é˜µè®¡ç®—ï¼šP = K[R|t]
   - æ—¶é—´åŒæ­¥ç­–ç•¥ï¼šç¡¬ä»¶è§¦å‘å’Œè½¯ä»¶æ’å€¼
   - PointPaintingç‰¹å¾èåˆ
   - æ·±åº¦è¡¥å…¨ç®—æ³•</p>
</li>
<li>
<p><strong>æ¿€å…‰é›·è¾¾+æ¯«ç±³æ³¢é›·è¾¾èåˆ</strong>ï¼š
   - å¡å°”æ›¼æ»¤æ³¢æ¡†æ¶èåˆé€Ÿåº¦ä¿¡æ¯
   - D-Sè¯æ®ç†è®ºèåˆæ£€æµ‹ç½®ä¿¡åº¦
   - æ¶åŠ£å¤©æ°”ä¸‹çš„äº’è¡¥ç­–ç•¥
   - æ•°æ®å…³è”ç®—æ³•</p>
</li>
<li>
<p><strong>æ¿€å…‰é›·è¾¾+IMUèåˆ</strong>ï¼š
   - è¯¯å·®çŠ¶æ€å¡å°”æ›¼æ»¤æ³¢ï¼ˆESKFï¼‰
   - IMUé¢„ç§¯åˆ†ç†è®ºï¼šÎ”p, Î”v, Î”R
   - è¿åŠ¨ç•¸å˜æ ¡æ­£
   - ç´§è€¦åˆSLAMä¼˜åŒ–</p>
</li>
<li>
<p><strong>æ¿€å…‰é›·è¾¾+GPS/RTKèåˆ</strong>ï¼š
   - å›¾ä¼˜åŒ–èåˆæ¡†æ¶
   - å¤šè·¯å¾„æ•ˆåº”å’ŒåŸå¸‚å³¡è°·é—®é¢˜å¤„ç†
   - æ¾è€¦åˆvsç´§è€¦åˆæ¶æ„
   - åæ ‡ç³»è½¬æ¢å’Œåˆå§‹åŒ–</p>
</li>
</ol>
<p>å¤šä¼ æ„Ÿå™¨èåˆçš„æ ¸å¿ƒæ˜¯å……åˆ†åˆ©ç”¨å„ä¼ æ„Ÿå™¨çš„ä¼˜åŠ¿ï¼Œé€šè¿‡åˆç†çš„æ•°å­¦æ¡†æ¶å®ç°ä¿¡æ¯äº’è¡¥ï¼Œæé«˜ç³»ç»Ÿçš„é²æ£’æ€§å’Œç²¾åº¦ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„èåˆç­–ç•¥ã€‚</p>
<h2 id="_2">ç»ƒä¹ é¢˜</h2>
<h3 id="_3">åŸºç¡€é¢˜</h3>
<ol>
<li><strong>åæ ‡è½¬æ¢è®¡ç®—</strong>
   æ¿€å…‰é›·è¾¾æ£€æµ‹åˆ°ç‚¹P_lidar = [5, 3, 1]mï¼Œå·²çŸ¥å¤–å‚ï¼šR = Rz(30Â°), t = [0.2, 0.1, 0.3]mï¼Œç›¸æœºå†…å‚fx=fy=800, cx=640, cy=480ã€‚è®¡ç®—è¯¥ç‚¹åœ¨å›¾åƒä¸­çš„åæ ‡ã€‚</li>
</ol>
<p><em>Hint: å…ˆè¿›è¡Œåæ ‡ç³»è½¬æ¢ï¼Œå†æŠ•å½±åˆ°å›¾åƒå¹³é¢</em></p>
<details markdown="block">
   <summary markdown="off">ç­”æ¡ˆ</summary>

   1. æ—‹è½¬çŸ©é˜µRz(30Â°) = [[0.866, -0.5, 0], [0.5, 0.866, 0], [0, 0, 1]]
   2. P_camera = RÂ·P_lidar + t = [3.03, 3.10, 1.3]m
   3. u = 800Ã—3.03/1.3 + 640 = 2505, v = 800Ã—3.10/1.3 + 480 = 2387
   </details>
<ol start="2">
<li><strong>å¡å°”æ›¼æ»¤æ³¢é¢„æµ‹</strong>
   ç›®æ ‡å½“å‰çŠ¶æ€x=[10, 5, 2, -1]ï¼ˆä½ç½®å’Œé€Ÿåº¦ï¼‰ï¼ŒÎ”t=0.1sï¼Œè®¡ç®—é¢„æµ‹çŠ¶æ€ã€‚</li>
</ol>
<p><em>Hint: ä½¿ç”¨åŒ€é€Ÿè¿åŠ¨æ¨¡å‹</em></p>
<details markdown="block">
   <summary markdown="off">ç­”æ¡ˆ</summary>

   F = [[1, 0, 0.1, 0], [0, 1, 0, 0.1], [0, 0, 1, 0], [0, 0, 0, 1]]
   x_pred = FÂ·x = [10.2, 4.9, 2, -1]
   </details>
<ol start="3">
<li><strong>IMUé¢„ç§¯åˆ†è®¡ç®—</strong>
   IMUæµ‹é‡åŠ é€Ÿåº¦a=[0.1, 0, 9.81]m/sÂ²ï¼Œè§’é€Ÿåº¦Ï‰=[0, 0, 0.1]rad/sï¼Œæ—¶é—´é—´éš”0.5sï¼Œè®¡ç®—é€Ÿåº¦å’Œä½ç½®å˜åŒ–ã€‚</li>
</ol>
<p><em>Hint: å¿½ç•¥é‡åŠ›ï¼Œå‡è®¾åˆå§‹é€Ÿåº¦ä¸º0</em></p>
<details markdown="block">
   <summary markdown="off">ç­”æ¡ˆ</summary>

   Î”v = aÃ—t = [0.05, 0, 4.905]m/s
   Î”p = 0.5Ã—aÃ—tÂ² = [0.0125, 0, 1.226]m
   </details>
<h3 id="_4">æŒ‘æˆ˜é¢˜</h3>
<ol start="4">
<li><strong>æ·±åº¦è¡¥å…¨ç®—æ³•è®¾è®¡</strong>
   è®¾è®¡ä¸€ä¸ªåŸºäºåŒè¾¹æ»¤æ³¢çš„æ·±åº¦è¡¥å…¨ç®—æ³•ï¼Œè€ƒè™‘é¢œè‰²ç›¸ä¼¼æ€§å’Œç©ºé—´è·ç¦»ã€‚ç»™å‡ºæƒé‡è®¡ç®—å…¬å¼å’Œå®ç°ä¼ªä»£ç ã€‚</li>
</ol>
<p><em>Hint: å‚è€ƒåŒè¾¹æ»¤æ³¢çš„æ•°å­¦å½¢å¼</em></p>
<details markdown="block">
   <summary markdown="off">ç­”æ¡ˆ</summary>

   æƒé‡ï¼šw(p,q) = exp(-||p-q||Â²/2Ïƒ_sÂ²) Ã— exp(-||I_p-I_q||Â²/2Ïƒ_rÂ²)
   æ·±åº¦ï¼šD(p) = Î£w(p,q)Ã—D(q) / Î£w(p,q)
   ä¼ªä»£ç ï¼šéå†çª—å£å†…æ‰€æœ‰åƒç´ ï¼Œè®¡ç®—æƒé‡ï¼ŒåŠ æƒå¹³å‡
   </details>
<ol start="5">
<li><strong>å¤šä¼ æ„Ÿå™¨æ—¶é—´åŒæ­¥</strong>
   æ¿€å…‰é›·è¾¾10Hzï¼Œç›¸æœº30Hzï¼ŒIMU 200Hzã€‚è®¾è®¡ä¸€ä¸ªæ—¶é—´åŒæ­¥æ–¹æ¡ˆï¼Œç¡®ä¿æ•°æ®å¯¹é½è¯¯å·®å°äº5msã€‚</li>
</ol>
<p><em>Hint: è€ƒè™‘ç¡¬ä»¶è§¦å‘å’Œè½¯ä»¶æ’å€¼</em></p>
<details markdown="block">
   <summary markdown="off">ç­”æ¡ˆ</summary>

   1. ä½¿ç”¨GPSçš„PPSä¿¡å·ä½œä¸ºå…¬å…±æ—¶é’Ÿ
   2. æ¿€å…‰é›·è¾¾è§¦å‘ç›¸æœºï¼Œç¡®ä¿3:1åŒæ­¥
   3. IMUæ•°æ®é€šè¿‡æ’å€¼å¯¹é½åˆ°æ¿€å…‰é›·è¾¾æ—¶åˆ»
   4. ç»´æŠ¤æ—¶é—´æˆ³ç¼“å†²åŒºï¼Œä½¿ç”¨æœ€è¿‘é‚»åŒ¹é…
   </details>
<ol start="6">
<li><strong>åŸå¸‚å³¡è°·GPSèåˆç­–ç•¥</strong>
   åœ¨åŸå¸‚å³¡è°·ç¯å¢ƒä¸­ï¼Œè®¾è®¡ä¸€ä¸ªè‡ªé€‚åº”çš„GPSæƒé‡è°ƒæ•´ç­–ç•¥ï¼Œè€ƒè™‘å«æ˜Ÿæ•°é‡ã€DOPå€¼å’Œä¿¡å·å¼ºåº¦ã€‚</li>
</ol>
<p><em>Hint: ä½¿ç”¨å¤šä¸ªæŒ‡æ ‡ç»¼åˆè¯„ä¼°GPSè´¨é‡</em></p>
<details markdown="block">
   <summary markdown="off">ç­”æ¡ˆ</summary>

   è´¨é‡å› å­Q = w1Ã—(n_sat/12) + w2Ã—(4/PDOP) + w3Ã—(CNR/50)
   GPSæƒé‡ = min(Q, 1.0)
   å½“Q &lt; 0.3æ—¶ï¼Œå®Œå…¨ä¾èµ–æ¿€å…‰é›·è¾¾SLAM
   </details>
<ol start="7">
<li><strong>IMUé›¶ååœ¨çº¿ä¼°è®¡</strong>
   è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œåœ¨è½¦è¾†é™æ­¢æ—¶åœ¨çº¿ä¼°è®¡IMUçš„åŠ é€Ÿåº¦è®¡å’Œé™€èºä»ªé›¶åã€‚</li>
</ol>
<p><em>Hint: é™æ­¢æ—¶ç†è®ºåŠ é€Ÿåº¦åº”ä¸ºé‡åŠ›ï¼Œè§’é€Ÿåº¦åº”ä¸º0</em></p>
<details markdown="block">
   <summary markdown="off">ç­”æ¡ˆ</summary>

   é™æ­¢æ£€æµ‹ï¼š||a|| âˆˆ [9.7, 9.9] &amp;&amp; ||Ï‰|| &lt; 0.01
   åŠ é€Ÿåº¦è®¡é›¶åï¼šb_a = mean(a) - g_ref
   é™€èºä»ªé›¶åï¼šb_g = mean(Ï‰)
   ä½¿ç”¨æ»‘åŠ¨çª—å£é¿å…å¼‚å¸¸å€¼
   </details>
<ol start="8">
<li><strong>å¤šä¼ æ„Ÿå™¨æ ‡å®šéªŒè¯</strong>
   è®¾è®¡ä¸€ä¸ªå®éªŒæ–¹æ¡ˆï¼ŒéªŒè¯æ¿€å…‰é›·è¾¾-ç›¸æœºå¤–å‚æ ‡å®šçš„å‡†ç¡®æ€§ï¼Œè¦æ±‚ç²¾åº¦è¾¾åˆ°åƒç´ çº§ã€‚</li>
</ol>
<p><em>Hint: ä½¿ç”¨æ ‡å®šæ¿æˆ–è‡ªç„¶ç‰¹å¾ç‚¹</em></p>
<details markdown="block">
   <summary markdown="off">ç­”æ¡ˆ</summary>

   1. ä½¿ç”¨æ£‹ç›˜æ ¼æ ‡å®šæ¿ï¼Œæ¿€å…‰é›·è¾¾æå–å¹³é¢ï¼Œç›¸æœºæ£€æµ‹è§’ç‚¹
   2. æŠ•å½±æ¿€å…‰é›·è¾¾å¹³é¢è¾¹ç¼˜åˆ°å›¾åƒï¼Œè®¡ç®—ä¸æ£€æµ‹è¾¹ç¼˜çš„åå·®
   3. ç»Ÿè®¡å¤šä¸ªä½ç½®çš„é‡æŠ•å½±è¯¯å·®RMS
   4. è¯¯å·®åº”å°äº2åƒç´ ï¼Œå¦åˆ™é‡æ–°æ ‡å®š
   </details>
            </article>
            
            <nav class="page-nav"><a href="chapter10.html" class="nav-link prev">â† Chapter 10: æ ‡å®šæŠ€æœ¯</a><a href="chapter12.html" class="nav-link next">Chapter 12: è‡ªåŠ¨é©¾é©¶ä¸“ç”¨ç« èŠ‚ â†’</a></nav>
        </main>
    </div>
</body>
</html>